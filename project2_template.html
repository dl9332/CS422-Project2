
<!-- template for Project 2 - CS 422 - Spring 2016 - Group 2 -->

<!DOCTYPE html>    
<head>
    <meta charset="utf-8">
    <title>fabric.js project template</title>
  
  <!-- Get version 1.5.0 of Fabric.js from CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/1.5.0/fabric.min.js" ></script>
    <script src="weather.js" ></script>



</head>

<body>
    <!-- canvas tag for Fabric.js to draw into -->
    <!-- set this to some appropriate size for your development work -->
    <!-- but keep the same aspect ratio -->
    <!-- we will use width="2714" height="2200" for presentations and evaluation -->
    <div class="canvas-container" style="width: 2714px; height: 2200px; position: relative; -webkit-user-select: none;" >
      <canvas id="c" width="2714" height="2200" style="border: 2px solid black; position: absolute; width: 2714px; height: 2200px; left: 0px; top: 0px; -webkit-user-select: none;" class="lower-canvas" ></canvas>
    </div>

 
<script>

// the aspect ratios given here are not quite tall enough for a 36" x 80" door
// we are assuming bottom 15 inches of the door are not part of the display. 
// that part contains lots of necessary electronics so the bottom of the door
// sits off the bottom of our display wall. You are implementing the interface
// for the top 65" of the display / door


// within the code below I assume I am drawing into a 1220x990 box
// then I can scale the group to whatever size the final canvas is
//API ID: aa4e2383e2f4acc395aeb12aa81c13ad
  var localHeight = 2200;
  var localWidth = 2714;
  var doorWidth = 1235;
  var topLeftInsideDoor = .2 * (localWidth-(2*doorWidth));
  var topLeftOutisdeDoor = localWidth - topLeftInsideDoor - doorWidth;
  var charmAppHW = doorWidth / 6;
  var quarterDoorHeight = localHeight / 4;
  var charmOffsetY = (localHeight - (localHeight * .75) - charmAppHW) / 2;
  var charmOffsetX = doorWidth / 18;
  var doorKnobStartY = .47 * localHeight;
  var doorKnobRadius = 75;
  var insideKnobStartX = topLeftInsideDoor + doorWidth - doorKnobRadius - charmOffsetX;
  var outsideKnobStartX = topLeftOutisdeDoor + doorKnobRadius + charmOffsetX;
  var userPic, emergencyPic, appPic, settingsPic;
  var URL = 'http://api.openweathermap.org/data/2.5/forecast/city?q=';
  var city = 'London,uk';
  var apiCode ='&APPID=aa4e2383e2f4acc395aeb12aa81c13ad';


///---------Start of Ryan's variable declarations\\
  var charmBar = [];
  var apps = [];
  var appIdx =0;
  charmBar.push({icon:"app",fp:'resources/app',active:false,create:false});


  for(i=0;i<6;i++){
      apps.push([]);
  }
  apps[0].push({icon:"weather",fp:'resources/weather',active:false,create:false,appIdx:0});
  apps[1].push({icon:"clock",fp:'resources/clock',active:false,create:false});
  apps[2].push({icon:"calender",fp:'resources/calender',active:false,create:false});
  apps[3].push({icon:"doorCam",fp:'resources/doorCam',active:false,create:false});
  apps[4].push({icon:"notes",fp:'resources/notes',active:false,create:false,appIdx:0});
  apps[5].push({icon:"home",fp:'resources/home',active:false,create:false});

  apps[0].push({icon:"weatMenu",fp:'resources/weatMenu',active:false,create:false});
  apps[0].push({icon:"options",fp:'resources/options',active:false,create:false});
  apps[0].push({icon:"weathAdd",fp:'resources/weathAdd',active:false,create:false});
  apps[0].push({icon:"add",fp:'resources/add',active:false,create:false});
  apps[0].push({icon:"back",fp:'resources/back',active:false,create:false,index:0});


  apps[3].push({icon:"mirror",fp:'resources/mirror',active:false,create:false});
  apps[3].push({icon:"peepCam",fp:'resources/peepCam',active:false,create:false});
  apps[3].push({icon:"back",fp:'resources/back',active:false,create:false});
  apps[3].push({icon:"bar",fp:'resources/bar',active:false,create:false});


  apps[4].push({icon:"noteCam",fp:'resources/noteCam',active:false,create:false});
  apps[4].push({icon:"notePad",fp:'resources/notePad',active:false,create:false});
  apps[4].push({icon:"noteBox",fp:'resources/noteBox',active:false,create:false});
  apps[4].push({icon:"postit",fp:'resources/postit',active:false,create:false});
  apps[4].push({icon:"bar2",fp:'resources/bar',active:false,create:false});
  apps[4].push({icon:"back1",fp:'resources/back',active:false,create:false});
  apps[4].push({icon:"group",fp:'resources/group',active:false,create:false});
  apps[4].push({icon:"single",fp:'resources/single',active:false,create:false});
  apps[4].push({icon:"left",fp:'resources/left',active:false,create:false});
  apps[4].push({icon:"right",fp:'resources/right',active:false,create:false});
  apps[4].push({icon:"circle",fp:'resources/circle',active:false,create:false});



//---------------End of Ryan's Variable declartions

 var canvas = this.__canvas = new fabric.Canvas('c');
 canvas.renderOnAddRemove = false;

  // set background to blue to make it easier to see it
  canvas.backgroundColor = "#DDDDDD";  // light grey

// need 36 wide instead of 40 as now

var insideDoor = new fabric.Rect({
  left: topLeftInsideDoor,
  top: 0,
  fill: 'white',
  stroke: 'black',
  width: doorWidth,
  height: localHeight,
  angle: 0
});

// the doors will not be selectable or movable
insideDoor.hasControls = insideDoor.hasBorders = false;
insideDoor.lockMovementX = insideDoor.lockMovementY = true;


var outsideDoor = new fabric.Rect({
  left: topLeftOutisdeDoor,
  top: 0,
  fill: 'white',
  stroke: 'black',
  width: doorWidth,
  height: localHeight,
  angle: 0
});

outsideDoor.hasControls = outsideDoor.hasBorders = false;
outsideDoor.lockMovementX = outsideDoor.lockMovementY = true;

  
// create a circle for the shower head location
var insideHandle = new fabric.Circle({
  radius: doorKnobRadius, fill: 'grey', left: insideKnobStartX , top: doorKnobStartY,   originX: 'center',
  originY: 'center'
});

// create a circle for the shower head location
var outsideHandle = new fabric.Circle({
  radius: doorKnobRadius, fill: 'grey', left: outsideKnobStartX, top: doorKnobStartY,   originX: 'center',
  originY: 'center'
});


/*-----------------------------------------------------------------
* CHARMS BAR
*  -appIcon
*  -emergencyIcon
*  -settingsIcon
*  -userIcon
*///---------------------------------------------------------------


var userIcon = new fabric.Image.fromURL('resources/single.png', function(img) {
  img.set({
    left: topLeftInsideDoor + charmOffsetX,
    top: charmOffsetY,
    width: charmAppHW,
    height: charmAppHW,
    originX: 'left',
    originY: 'top',
    visible: true
  });
  canvas.add(img).setActiveObject(img);
  userPic = canvas.getActiveObject();
  userPic.on('moving', function(){
    emergencyPic.top = userPic.getTop() + quarterDoorHeight;
    canvas.remove(emergencyPic);
    canvas.add(emergencyPic);
    appPic.top = emergencyPic.getTop() + quarterDoorHeight;
    canvas.remove(appPic);
    canvas.add(appPic);
    settingsPic.top = appPic.getTop() + quarterDoorHeight;
    canvas.remove(settingsPic);
    canvas.add(settingsPic);

      //updateAppPos();

      canvas.deactivateAll();
    //canvas.renderAll();
    //fabric.util.requestAnimFrame(animate);
  });
  userPic.lockMovementX = true;
  userPic.lockMovementY = false;}
);


var emergencyIcon =  new fabric.Image.fromURL('resources/shield.png', function(img) {
  img.set({
    left: topLeftInsideDoor + charmOffsetX,
    top: quarterDoorHeight + charmOffsetY,
    width: charmAppHW,
    height: charmAppHW,
    originX: 'left',
    originY: 'top',
    visible: true
  });
  canvas.add(img).setActiveObject(img);
  emergencyPic = canvas.getActiveObject();
  emergencyPic.on('moving', function(){
  userPic.top = emergencyPic.getTop() - quarterDoorHeight;
  canvas.remove(userPic);
  canvas.add(userPic);
  appPic.top = emergencyPic.getTop() + quarterDoorHeight;
  canvas.remove(appPic);
  canvas.add(appPic);
  settingsPic.top = appPic.getTop() + quarterDoorHeight;
  canvas.remove(settingsPic);
  canvas.add(settingsPic)

      updateAppPos();
    //canvas.renderAll();
    //fabric.util.requestAnimFrame(animate);
  });
  emergencyPic.lockMovementX = true; 
  emergencyPic.lockMovementY = false;}
);

var appIcon;
var appPic=0;
function createAppIcon(icon){
    iconPath = icon.fp;
    canvas.remove(appPic);
    if(icon.active==true) {
        iconPath = iconPath + '2';
    }




    appIcon = new fabric.Image.fromURL(iconPath +'.png', function(img) {
                if(icon.create==true) {
                    img.set({
                        left: appPic.left,
                        top: appPic.top,
                        width: charmAppHW,
                        height: charmAppHW,
                        originX: 'left',
                        originY: 'top',
                        visible: true
                    });
                }
                else {
                    img.set({
                        left: topLeftInsideDoor + charmOffsetX,
                        top: (quarterDoorHeight * 2) + charmOffsetY,
                        width: charmAppHW,
                        height: charmAppHW,
                        originX: 'left',
                        originY: 'top',
                        visible: true
                    });
                    icon.create = true;
                }
                canvas.add(img).setActiveObject(img);

                appPic = canvas.getActiveObject();
                appPic.on('moving', function(){

                    userPic.top = emergencyPic.getTop() - quarterDoorHeight;
                    canvas.remove(userPic);
                    canvas.add(userPic);
                    settingsPic.top = appPic.getTop() + quarterDoorHeight;
                    canvas.remove(settingsPic);
                    canvas.add(settingsPic);
                    emergencyPic.top = appPic.getTop() - quarterDoorHeight;
                    canvas.remove(emergencyPic);
                    canvas.add(emergencyPic);

                    updateAppPos();
                    //updateCamPos();

                    canvas.deactivateAll();
                   // canvas.renderAll();
                    //fabric.util.requestAnimFrame(animate);
                });

                appPic.on('selected',function(){
                    if(charmBar[0].active==true) {
                        charmBar[0].active = false;
                        if(apps[appIdx][0].active==true){
                            closeApp(apps[appIdx][0].icon);
                            apps[appIdx][0].active=false;
                        }
                        activeIcon(charmBar[0]);
                        updateApps(false);
                    }
                    else if(charmBar[0].active==false) {
                        charmBar[0].active = true;
                        activeIcon(charmBar[0]);
                        updateApps(true);
                    }

                    canvas.deactivateAll();

                })
                appPic.lockMovementX = true;
                appPic.lockMovementY = false;}
    );

}
createAppIcon(charmBar[0]);

/*var appIcon = new fabric.Image.fromURL('resources/app.png', function(img) {
  img.set({
    left: topLeftInsideDoor + charmOffsetX,
    top: (quarterDoorHeight * 2) + charmOffsetY,
    width: charmAppHW,
    height: charmAppHW,
    originX: 'left',
    originY: 'top',
    visible: true
  });
  canvas.add(img).setActiveObject(img);
  appPic = canvas.getActiveObject();
  appPic.on('moving', function(){
    userPic.top = emergencyPic.getTop() - quarterDoorHeight;
    settingsPic.top = appPic.getTop() + quarterDoorHeight;
    emergencyPic.top = appPic.getTop() - quarterDoorHeight;

    canvas.renderAll();
    fabric.util.requestAnimFrame(animate);
  });

  appPic.on('selected',function(){
      console.log("app's have been selected")
      if(app[0].active==true) {
          app[0].active = false;
          activeIcon(app[0]);
      }
      else if(app[0].active==false) {
          app[0].active = true;
          activeIcon(app[0]);
      }

  })


  appPic.lockMovementX = true;
  appPic.lockMovementY = false;}
);

*/


var settingsIcon = new fabric.Image.fromURL('resources/settings.png', function(img) {
  img.set({
    left: topLeftInsideDoor + charmOffsetX,
    top: (quarterDoorHeight * 3) + charmOffsetY,
    width: charmAppHW,
    height: charmAppHW,
    originX: 'left',
    originY: 'top',
    visible: true
  });
  canvas.add(img).setActiveObject(img);
  settingsPic = canvas.getActiveObject();
  settingsPic.on('moving', function(){
    userPic.top = emergencyPic.getTop() - quarterDoorHeight;
    canvas.remove(userPic);
    canvas.add(userPic);
    appPic.top = settingsPic.getTop() - quarterDoorHeight;
    canvas.remove(appPic);
    canvas.add(appPic)
    emergencyPic.top = appPic.getTop() - quarterDoorHeight;
    canvas.remove(emergencyPic);
    canvas.add(emergencyPic);
      updateAppPos();
    //canvas.deactivateAll();
    canvas.renderAll();
    //fabric.util.requestAnimFrame(animate);
  });
  settingsPic.lockMovementX = true;
  settingsPic.lockMovementY = false;}
);



/*function slideDown()
{
  var tempGroup = charmsBar;

  charmsBar = new fabric.Group([ charmsBar[3], charmsBar[0], charmsBar[1], charmsBar[2] ], {
    left: tempGroup.getLeft(),
    top: tempGroup.getTop()
  });
}

function slideUp()
{
  var tempGroup = charmsBar;

  charmsBar = new fabric.Group([ charmsBar[1], charmsBar[2], charmsBar[3], charmsBar[0] ], {
    left: tempGroup.getLeft(),
    top: tempGroup.getTop()
  });
}*/

function moveCharms()
{
  /*if(y < charmAppHW)
  {
    slideUp()
  }
  else if(y > localHeight - charmAppHW)
  {
    slideDown()
  }*/


}
//----------------------------Ryan's Code Start----------------------------------------


 function activeIcon(app){
     app.create = true;
     if(app.icon ==  'app')
       createAppIcon(app);
     canvas.deactivateAll();
 }

function createApps(){
    createWeather(apps[0][0]);
    createClock(apps[1][0]);
    createCalender(apps[2][0]);
    createDoorCam(apps[3][0]);
    createNotes(apps[4][0]);
    createHome(apps[5][0]);
    createDoorCamApp();
    createNoteApp();
    createWeatherApp();

}

createApps();


function createWeatherApp(){
    iconPath = apps[0][1].fp;
    //canvas.remove(weatPic);


     weatherAppMain= new fabric.Image.fromURL(iconPath +'.png', function(img) {
                img.set({left: appPic.left *3, top: appPic.top -200, width: charmAppHW*3, height: charmAppHW+50, originX: 'left',
                    originY: 'top', visible: false});
                canvas.add(img).setActiveObject(img);
                createWeatherText();
                weatAppPic = canvas.getActiveObject();
                 weatAppPic.lockMovementX = true;
                 weatAppPic.lockMovementY = true;}
    );


    iconPath = apps[0][2].fp;
    optionsIcon= new fabric.Image.fromURL(iconPath +'.png', function(img) {
                img.set({left: appPic.left *7, top: appPic.top -190, width: charmAppHW-100, height: charmAppHW-100, originX: 'left',
                    originY: 'top', visible: false});
                canvas.add(img).setActiveObject(img);
                optionsPic = canvas.getActiveObject();

                optionsPic.on('selected',function(){

                    canvas.deactivateAll();

                })

                optionsPic.lockMovementX = true;
                optionsPic.lockMovementY = true;}
    );

    iconPath = apps[0][4].fp;
    addIcon= new fabric.Image.fromURL(iconPath +'.png', function(img) {
                img.set({left: appPic.left *7, top: appPic.top+80, width: charmAppHW -50, height: charmAppHW -50, originX: 'left',
                    originY: 'top', visible: false});
                canvas.add(img).setActiveObject(img);
                addPic = canvas.getActiveObject();
                addPic.on('selected',function(){
                    if(apps[0][0].appIdx==1) {
                        updateWeatApp(true, 2);
                        apps[0][0].appIdx = 2;
                    }
                    else{
                        apps[0][0].appIdx = 1;
                        var text = searchText.text;
                        text = text.trim();
                        city = text;
                        json_obj = get(URL+city+apiCode);
                        updateWeatApp(true,1);
                    }
                    //var json_obj = JSON.parse(get(URL+city+apiCode));
                    canvas.deactivateAll();
                })

                addPic.lockMovementX = true;
                addPic.lockMovementY = true;}
    );

    iconPath = apps[0][5].fp;

    weatBack= new fabric.Image.fromURL(iconPath +'.png', function(img) {
                img.set({left: appPic.left*5.5, top: appPic.top+80, width: charmAppHW -50, height: charmAppHW -50, originX: 'left',
                    originY: 'top', visible: false});
                canvas.add(img).setActiveObject(img);
                backPic0 = canvas.getActiveObject();
                backPic0.on('selected',function(){
                    if(backPic0.index==2) {
                        apps[0][0].appIdx=1;
                        updateWeatApp(true, 1);
                    }
                    else if(backPic0.index==1) {
                        apps[0][0].appIdx=0;
                        updateWeatApp(false, 3);
                    }
                    canvas.deactivateAll();

                })
                backPic0.index = 0;
                backPic0.lockMovementX = true;
                backPic0.lockMovementY = true;}
    );




    clouds= new fabric.Image.fromURL('resources/clouds.png', function(img) {
                img.set({left: appPic.left *6.5, top: appPic.top-100, width: charmAppHW-100, height: charmAppHW-100, originX: 'left',
                    originY: 'top', visible: false, lockMovementX: true, lockMovementY:true});
                canvas.add(img).setActiveObject(img);
                cloudsPic = canvas.getActiveObject();}
    );

}
var textBuff = ({text:null,active:false,count:0});
var line = [];
function createWeatherText(){
    weatHeader = new fabric.Text("Weather", {left:appPic.left+250,top:appPic.top-200,fontFamily: 'Arial',fill:'white', fontSize: 60, fontWeight: 'italic', originX: 'left',
        originY: 'top',visible:false,selectable:false,evented:false,lockMovementX:true, lockMovementY:true});

    weatHeader2 = new fabric.Text("City List:", {left:appPic.left+250,top:appPic.top-130,fontFamily: 'Arial',fill:'white', fontSize: 40, fontWeight: 'italic', originX: 'left',
        originY: 'top',visible:false,selectable:false,evented:false,lockMovementX:true, lockMovementY:true});

    city = new fabric.Text("Chicago", {left:appPic.left+280,top:appPic.top-80,fontFamily: 'Arial',fill:'black', fontSize: 35, fontWeight: 'italic', originX: 'left',
        originY: 'top',visible:false,selectable:false,evented:false,lockMovementX:true, lockMovementY:true});


    countryOrign = new fabric.Text("Illinois,United States", {left:appPic.left+280,top:appPic.top-40,fontFamily: 'Arial',fill:'black', fontSize: 35, fontWeight: 'italic', originX: 'left',
        originY:'top',visible:false,selectable:false,evented:false,lockMovementX:true, lockMovementY:true});

    time = new fabric.Text("12:58am", {left:appPic.left+280,top:appPic.top,fontFamily: 'Arial',fill:'black', fontSize: 35, fontWeight: 'italic', originX: 'left',
        originY: 'top',visible:false,selectable:false,evented:false,lockMovementX:true, lockMovementY:true});

    temp = new fabric.Text("78", {left:appPic.left*6.8,top:appPic.top,fontFamily: 'Arial',fill:'black', fontSize: 35, fontWeight: 'italic', originX: 'left',
        originY: 'top',visible:false,selectable:false,evented:false,lockMovementX:true, lockMovementY:true});

    degree = new fabric.Text("o", {left:appPic.left*7.2,top:appPic.top-5,fontFamily: 'Arial',fill:'black', fontSize: 24, fontWeight: 'italic', originX: 'left',
        originY: 'top',visible:false,selectable:false,evented:false,lockMovementX:true, lockMovementY:true});

    tempScale = new fabric.Text("F", {left:appPic.left*7.3,top:appPic.top,fontFamily: 'Arial',fill:'black', fontSize: 35, fontWeight: 'italic', originX: 'left',
        originY: 'top',visible:false,selectable:false,evented:false,lockMovementX:true, lockMovementY:true});

    searchText = new fabric.IText("Search City", {left:appPic.left*3.5,top:appPic.top-50, width:5,fontFamily: 'Arial',fill:'black', fontSize: 35, fontWeight: 'italic', originX: 'left',
        originY: 'top',visible:false,lineHeight:1,lockMovementX:true,lockMovementY:true,hasControls:false});
    textBox = new fabric.Rect({left:appPic.left*3.5,top:appPic.top-60,height:charmAppHW-150,width:charmAppHW*2.5,fill:'white',visible:false,hasControls:false,lockMovementX:true,
        lockMovementY:true });

    searchText.entered = false;
    searchText.on('editing:entered',function(){
        if(searchText.entered==false) {
            searchText.text ="   ";

            searchText.entered=true;
        }
    })

   searchText.on('selection:changed',function(){
       //trimText = searchText.text;
       //searchText.text = trimText.trim();

       if(searchText.text.length==25&&textBuff.active==false){
           searchText.text;
           textBuff.text = searchText.text;
          //textBuff.count = 28;
          textBuff.active = true;
       }
        else if(searchText.text.length>=26){
           searchText.text = searchText.text.trim();
           var line=searchText.text[1];
           for(i=2;i<searchText.text.length;i++)
             line = line + searchText.text[i];

           searchText.text = line;
        }
    })



    canvas.add(textBox);
    canvas.add(weatHeader);
    canvas.add(weatHeader2);
    canvas.add(city);
    canvas.add(countryOrign);
    canvas.add(time);
    canvas.add(temp);
    canvas.add(degree);
    canvas.add(tempScale);
    canvas.add(searchText);


}

function createWeather(icon) {
  iconPath = icon.fp;
  weatIcon = new fabric.Image.fromURL(iconPath +'.png', function(img) {

              img.set({
                left: appPic.left *3,top: appPic.top - 200,width: charmAppHW,height: charmAppHW,originX: 'left',
                  originY: 'top', visible: false});

            canvas.add(img).setActiveObject(img);
            weatPic = canvas.getActiveObject();

           weatPic.on('selected',function(){
              updateApps(false);
              updateWeatApp(true,1);
              apps[0][0].active = true;
              appIdx = 0;
              canvas.deactivateAll();

          })

            weatPic.lockMovementX = true;
            weatPic.lockMovementY = true;}
  );


}


function createClock(icon) {
    iconPath = icon.fp;
    clockIcon = new fabric.Image.fromURL(iconPath +'.png', function(img) {

                img.set({
                    left: appPic.left *5,top: appPic.top - 200, width: charmAppHW, height: charmAppHW, originX: 'left',
                    originY: 'top', visible: false
                });


                canvas.add(img).setActiveObject(img);
                clockPic = canvas.getActiveObject();

                clockPic.lockMovementX = false;
                clockPic.lockMovementY = false;}
    );

}

function createCalender(icon) {

    iconPath = icon.fp;
    calenderIcon = new fabric.Image.fromURL(iconPath +'.png', function(img) {

                img.set({
                    left: appPic.left *7,top: appPic.top - 200, width: charmAppHW, height: charmAppHW, originX: 'left',
                    originY: 'top', visible: false
                });

                canvas.add(img).setActiveObject(img);
                calenderPic = canvas.getActiveObject();

                calenderPic.lockMovementX = true;
                calenderPic.lockMovementY = true;}
    );

}


function createDoorCam(icon) {

    iconPath = icon.fp;
    doorCamIcon = new fabric.Image.fromURL(iconPath +'.png', function(img) {

                img.set({
                    left: appPic.left *3, top: appPic.top *1, width: charmAppHW, height: charmAppHW, originX: 'left',
                    originY: 'top', visible: false
                });

                canvas.add(img).setActiveObject(img);
                doorCamPic = canvas.getActiveObject();
                doorCamPic.on('selected',function(){
                    updateApps(false);
                    updateCamApp(true,4);
                    apps[3][0].active = true;
                    appIdx = 3;
                    canvas.deactivateAll();

                })

                doorCamPic.lockMovementX = true;
                doorCamPic.lockMovementY = true;}
    );

}

function createDoorCamApp(){
    iconPath = apps[3][4].fp;
    camMenubar = new fabric.Image.fromURL(iconPath +'.png', function(img) {

                img.set({
                    left: appPic.left *3, top: appPic.top *1.02, width: charmAppHW*3.3, height: charmAppHW-80, originX: 'left',
                    originY: 'top', visible: false,lockMovementX:true,lockMovementY:true
                });

                canvas.add(img).setActiveObject(img);
                camMenuPic = canvas.getActiveObject();}
    );

    iconPath = apps[3][1].fp;
    mirrorIcon = new fabric.Image.fromURL(iconPath +'.png', function(img) {

                img.set({
                    left: appPic.left *3, top: appPic.top *1, width: charmAppHW, height: charmAppHW, originX: 'left',
                    originY: 'top', visible: false,lockMovementX:true,lockMovementY:true
                });

                canvas.add(img).setActiveObject(img);
                mirrorPic = canvas.getActiveObject();

                mirrorPic.on('selected',function(){updateCamApp(true,1);canvas.deactivateAll();})
               }
    );


    mirrorIcon2 = new fabric.Image.fromURL(iconPath +2+'.png', function(img) {

                img.set({
                    left: appPic.left *3, top: appPic.top *1, width: charmAppHW, height: charmAppHW, originX: 'left',
                    originY: 'top', visible: false,lockMovementX:true,lockMovementY:true});

                canvas.add(img).setActiveObject(img);
                mirrorPic2 = canvas.getActiveObject();
                mirrorPic2.on('selected',function(){updateCamApp(false,1);canvas.deactivateAll();})
            }
    );


    iconPath = apps[3][2].fp;
    peepIcon = new fabric.Image.fromURL(iconPath +'.png', function(img) {

                img.set({
                    left: appPic.left *5, top: appPic.top *1, width: charmAppHW, height: charmAppHW, originX: 'left',
                    originY: 'top', visible: false,lockMovementX:true,lockMovementY:true});


                canvas.add(img).setActiveObject(img);
                peepPic = canvas.getActiveObject();

                peepPic.on('selected',function(){updateCamApp(true,2);canvas.deactivateAll();})
            }
    );

    iconPath = apps[3][2].fp;
    peepIcon2 = new fabric.Image.fromURL(iconPath +'2'+'.png', function(img) {

                img.set({
                    left: appPic.left *5, top: appPic.top *1, width: charmAppHW, height: charmAppHW, originX: 'left',
                    originY: 'top', visible: false,lockMovementX:true,lockMovementY:true});

                canvas.add(img).setActiveObject(img);
                peepPic2 = canvas.getActiveObject();

                peepPic2.on('selected',function(){updateCamApp(false,2);canvas.deactivateAll();})}
    );

    iconPath = apps[3][3].fp;
    backIcon = new fabric.Image.fromURL(iconPath +'.png', function(img) {

                img.set({
                    left: appPic.left *7, top: appPic.top *1, width: charmAppHW, height: charmAppHW, originX: 'left',
                    originY: 'top', visible: false,lockMovementX:true,lockMovementY:true});

                canvas.add(img).setActiveObject(img);
                backPic = canvas.getActiveObject();


                backPic.on('selected',function(){
                    if(appIdx==3) {
                        updateCamApp(false, 3);
                        apps[3][0].active = false;
                    }
                    else if(appIdx==4){
                        if(apps[4][0].appIdx==3){
                            updateNoteApp(false, 3);
                            updateNoteApp(true,2);
                            //updateApps(true);
                            apps[4][0].appIdx = 2;

                        }
                        else {
                            updateNoteApp(false, 0);
                            updateApps(true);
                            apps[4][0].appIdx=0;
                            apps[4][0].active = false;
                        }

                    }
                    canvas.deactivateAll();})

                backPic.lockMovementX = true;
                backPic.lockMovementY = true;}
    );

}
function createNoteApp(){
    iconPath = apps[4][1].fp;
    noteCamIcon = new fabric.Image.fromURL(iconPath +'.png', function(img) {

                img.set({left: appPic.left *3 , top: appPic.top *1, width: charmAppHW, height: charmAppHW,
                    originX: 'left', originY: 'top', visible: false,lockMovementX:true,lockMovementY:true
                });

                canvas.add(img).setActiveObject(img);
                noteCamPic = canvas.getActiveObject();

                noteCamPic.on('selected',function(){
                    updateNoteApp(true,3);
                    canvas.deactivateAll();

                })
            }
    );


    iconPath = apps[4][2].fp;
    notePadIcon = new fabric.Image.fromURL(iconPath +'.png', function(img) {

                img.set({left: appPic.left *5 , top: appPic.top *1, width: charmAppHW, height: charmAppHW,
                    originX: 'left', originY: 'top', visible: false,lockMovementX:true,lockMovementY:true
                });

                canvas.add(img).setActiveObject(img);
                notePadPic = canvas.getActiveObject();

                notePadPic.on('selected',function(){
                    updateNoteApp(true,2);
                    canvas.deactivateAll();
                })
            }
    );



    iconPath = apps[4][3].fp;
    noteBoxIcon = new fabric.Image.fromURL(iconPath +'.png', function(img) {

                img.set({left: appPic.left *4 , top: appPic.top -200, width: charmAppHW+300, height: charmAppHW+400,
                    originX: 'left', originY: 'top', visible: false,lockMovementX:true,lockMovementY:true
                });

                canvas.add(img).setActiveObject(img);
                noteBoxPic = canvas.getActiveObject();
                noteAppText();
            }
    );


    iconPath = apps[4][5].fp;
    noteBarIcon = new fabric.Image.fromURL(iconPath +'.png', function(img) {

                img.set({left: appPic.left *4.2 , top: appPic.top -160, width:charmAppHW, height: charmAppHW-130,
                    originX: 'left', originY: 'top', visible: false,lockMovementX:true,lockMovementY:true
                });

                canvas.add(img).setActiveObject(img);
                noteBarPic = canvas.getActiveObject();

            }
    );

    iconPath = apps[4][4].fp;
    postItIcon = new fabric.Image.fromURL(iconPath +'.png', function(img) {

                img.set({left: appPic.left *4.1 , top: appPic.top -170, width: charmAppHW-100, height: charmAppHW-100,
                    originX: 'left', originY: 'top', visible: false,lockMovementX:true,lockMovementY:true
                });

                canvas.add(img).setActiveObject(img);
                postItPic = canvas.getActiveObject();

                postItPic.on('selected',function(){
                    updateNoteApp(false,2);
                    updateNoteApp(true,3);
                    canvas.deactivateAll();
                })

            }
    );

    iconPath = apps[4][6].fp;
    backIcon1 = new fabric.Image.fromURL(iconPath +'.png', function(img) {

                img.set({left: appPic.left *5.2 , top: appPic.top -170, width:charmAppHW-100, height: charmAppHW-100,
                    originX: 'left', originY: 'top', visible: false,lockMovementX:true,lockMovementY:true
                });

                canvas.add(img).setActiveObject(img);
                backPic1 = canvas.getActiveObject();

                backPic1.on('selected',function(){
                    updateNoteApp(false,2)
                    updateNoteApp(true,1);
                    canvas.deactivateAll();
                })

            }
    );

    iconPath = apps[4][7].fp;
    groupIcon = new fabric.Image.fromURL(iconPath +'.png', function(img) {

                img.set({left: appPic.left *3 , top: appPic.top *1, width: charmAppHW, height: charmAppHW,
                    originX: 'left', originY: 'top', visible:false,lockMovementX:true,lockMovementY:true
                });

                canvas.add(img).setActiveObject(img);
                groupPic = canvas.getActiveObject();

                groupPic.on('selected',function(){
                    updateNoteApp(false,1);
                    canvas.deactivateAll();

                })
            }
    );


    iconPath = apps[4][8].fp;
    singleIcon = new fabric.Image.fromURL(iconPath +'.png', function(img) {

                img.set({left: appPic.left *5 , top: appPic.top *1, width: charmAppHW, height: charmAppHW,
                    originX: 'left', originY: 'top', visible: false,lockMovementX:true,lockMovementY:true
                });

                canvas.add(img).setActiveObject(img);
                singlePic = canvas.getActiveObject();

                singlePic.on('selected',function(){
                    updateNoteApp(false,3);
                    updateNoteApp(true,4);
                    canvas.deactivateAll();
                })
            }
    );

    iconPath = apps[4][9].fp;
    leftIcon = new fabric.Image.fromURL(iconPath +'.png', function(img) {

                img.set({left: appPic.left, top: appPic.top+270, width: charmAppHW, height: charmAppHW,
                    originX: 'left', originY: 'top', visible: false,lockMovementX:true,lockMovementY:true
                });

                canvas.add(img).setActiveObject(img);
                leftPic = canvas.getActiveObject();

                leftPic.on('selected',function(){
                    //updateNoteApp(true,5);
                    canvas.deactivateAll();
                })
            }
    );

    iconPath = apps[4][10].fp;
    rightIcon = new fabric.Image.fromURL(iconPath +'.png', function(img) {

                img.set({left: appPic.left*9 , top: appPic.top+250, width: charmAppHW, height: charmAppHW,
                    originX: 'left', originY: 'top', visible: false,lockMovementX:true,lockMovementY:true
                });

                canvas.add(img).setActiveObject(img);
                rightPic = canvas.getActiveObject();

                rightPic.on('selected',function(){
                    //updateNoteApp(true,5);
                    canvas.deactivateAll();
                })
            }
    );
    iconPath = apps[4][11].fp;
    circleIcon = new fabric.Image.fromURL(iconPath +'.png', function(img) {

                img.set({left: appPic.left *3 , top: appPic.top+250, width: charmAppHW, height: charmAppHW,
                    originX: 'left', originY: 'top', visible:false,lockMovementX:true,lockMovementY:true
                });

                canvas.add(img).setActiveObject(img);
                circle1 = canvas.getActiveObject();

                circle1.on('selected',function(){
                    updateNoteApp(false,4);
                    updateNoteApp(false,1);
                    canvas.deactivateAll();
                })
            }
    );


    circleIcon2 = new fabric.Image.fromURL(iconPath +'.png', function(img) {

                img.set({left: appPic.left *5 , top: appPic.top+250, width: charmAppHW, height: charmAppHW,
                    originX: 'left', originY: 'top', visible:false,lockMovementX:true,lockMovementY:true
                });

                canvas.add(img).setActiveObject(img);
                circle2 = canvas.getActiveObject();

                circle2.on('selected',function(){
                    updateNoteApp(false,4);
                    updateNoteApp(false,1);
                    canvas.deactivateAll();
                })
            }
    );

    circleIcon3 = new fabric.Image.fromURL(iconPath +'.png', function(img) {

                img.set({left: appPic.left *7 , top: appPic.top+250, width: charmAppHW, height: charmAppHW,
                    originX: 'left', originY: 'top', visible:false,lockMovementX:true,lockMovementY:true
                });

                canvas.add(img).setActiveObject(img);
                circle3 = canvas.getActiveObject();

                circle3.on('selected',function(){
                    updateNoteApp(false,4);
                    updateNoteApp(false,1);
                    canvas.deactivateAll();
                })
            }
    );








}
function noteAppText(){

    noteHeader = new fabric.Text("New Note", {left:appPic.left+380,top:appPic.top-80,fontFamily: 'Arial',fill:'black', fontSize: 40, fontWeight: 'italic', originX: 'left',
        originY: 'top',visible:false,selectable:false,evented:false,lockMovementX:true, lockMovementY:true});
    canvas.add(noteHeader);

    message = new fabric.IText("Add Note",{left:appPic.left+380,top:appPic.top-30, width:5,fontFamily: 'Arial',fill:'black', fontSize: 34, fontWeight: 'italic', originX: 'left',
        originY: 'top',visible:false,lineHeight:1,lockMovementX:true,lockMovementY:true,hasControls:false});
    canvas.add(message);
    message.entered=false;
    message.on('editing:entered',function(){
        if(message.entered==false) {
            message.text ="   ";
            message.entered=true;
        }
    })

}

function createNotes(icon) {

    iconPath = icon.fp;
    notesIcon = new fabric.Image.fromURL(iconPath +'.png', function(img) {
                img.set({
                    left: appPic.left *5,top: appPic.top * 1,width: charmAppHW, height: charmAppHW,
                    originX: 'left', originY: 'top', visible: false, lockMovementX:true,lockMovementY:true
                });
                canvas.add(img).setActiveObject(img);
                notesPic = canvas.getActiveObject();
                notesPic.on('selected',function(){
                    apps[4][0].active=true;
                    appIdx=4;
                    updateNoteApp(true,1);
                    canvas.deactivateAll();
                })
            });

}

function createHome(icon) {
    iconPath = icon.fp;
    homeIcon = new fabric.Image.fromURL(iconPath +'.png', function(img) {

                img.set({left: appPic.left *7, top: appPic.top * 1, width: charmAppHW, height: charmAppHW, originX: 'left',
                    originY: 'top', visible: false,lockMovementX:true,lockMovementY:true});

                canvas.add(img).setActiveObject(img);
                homePic = canvas.getActiveObject();
            }
    );

}

function updateAppPos(){
    weatPic.top = appPic.top - 200;
    canvas.remove(weatPic);
    canvas.add(weatPic);
    clockPic.top = appPic.top - 200;
    canvas.remove(clockPic);
    canvas.add(clockPic);
    calenderPic.top = appPic.top - 200;
    canvas.remove(calenderPic);
    canvas.add(calenderPic);
    doorCamPic.top = appPic.top;
    canvas.remove(doorCamPic);
    canvas.add(doorCamPic);
    notesPic.top = appPic.top;
    canvas.remove(notesPic);
    canvas.add(notesPic);
    homePic.top = appPic.top;
    canvas.remove(homePic);
    canvas.add(homePic);


}
function updateCamApp(isVisible,menuId){


    if(menuId==1){
        if(isVisible==true) {
            apps[3][1].active=true;
            mirrorPic2.visible = true;
            mirrorPic.visible = false;

            peepPic2.visible = false;
            peepPic.visible = true;
        }
        else {
            apps[3][1].active = false;
            mirrorPic2.visible = false;
            mirrorPic.visible = true;


        }
    }
    else if(menuId==2){
        if(isVisible==true) {
            apps[3][2].active=true;
            peepPic2.visible = true;
            peepPic.visible = false;

            mirrorPic2.visible = false;
            mirrorPic.visible = true;
        }
        else {
            apps[3][2].active = false;
            peepPic2.visible = false;
            peepPic.visible = true;
        }


    }
    else if(menuId==3){
        updateApps(true);
        if(isVisible==false) {
            backPic.visible = false;
            peepPic.visible = false;
            peepPic2.visible = false;
            mirrorPic.visible = false;
            mirrorPic2.visible = false;
            camMenuPic.visible = false;
        }

    }
    else{
        if(isVisible==true){
            camMenuPic.visible = true;
            peepPic.visible = true;
            backPic.visible = true;
            mirrorPic.visible = true;
        }

    }
}






function updateWeatApp(isVisible,menuId){


    if(menuId==1){
        if(isVisible==true) {
            apps[0][1].active=true;
            weatAppPic.visible = true;
            optionsPic.visible = true;
            addPic.visible = true;
            backPic0.visible = true;



            weatHeader.visible = true;
            weatHeader2.visible=true;
            weatHeader2.text = "City List:";

            city.visible=true;
            countryOrign.visible=true;
            time.visible=true;
            temp.visible=true;
            degree.visible=true;
            tempScale.visible=true;
            cloudsPic.visible=true;

            searchText.visible=false;
            textBox.visible=false;
            searchText.entered=false;
            searchText.text="Search Cities";
            backPic0.index = 1;
        }

    }
    else if(menuId==2){
        if(isVisible==true) {
         weatHeader2.text = "Add a city:";
         optionsPic.visible = false;
         addPic.visible=true;
         textBox.visible=true;

         city.visible = false;
         countryOrign.visible=false;
         time.visible = false;
         temp.visible =false;
         degree.visible=false;
         tempScale.visible=false;
         searchText.visible=true;

         cloudsPic.visible=false;
         backPic0.index = 2;
        }


    }
    else if(menuId==3){
        updateApps(true);
        if(isVisible==false) {
            backPic0.index = 0;
            apps[0][1].active=false;
            weatAppPic.visible = false;
            optionsPic.visible = false;
            addPic.visible = false;
            backPic0.visible=false;

            weatHeader.visible = false;
            weatHeader2.visible=false;
            weatHeader2.text = "City List:";

            city.visible=false;
            countryOrign.visible=false;
            time.visible=false;
            temp.visible=false;
            degree.visible=false;
            tempScale.visible=false;
            searchText.visible=false;

            cloudsPic.visible=false;
        }
    }
}

function updateNoteApp(isVisible,menuId){


    if(menuId==1){
        if(isVisible==true) {
            updateApps(false);
            noteCamPic.visible = true;
            notePadPic.visible = true;
            backPic.visible = true;
            camMenuPic.visible = true;
            apps[4][0].appIdx=1;
        }
        else if(isVisible==false){
            noteCamPic.visible = false;
            notePadPic.visible = false;
            backPic.visible = false;
            camMenuPic.visible = false;
        }


    }
    else if(menuId==2){
        if(isVisible==true) {
            noteBarPic.visible = true;
            noteBoxPic.visible = true;
            postItPic.visible = true;
            backPic1.visible = true;
            noteHeader.visible = true;
            message.visible = true;

            noteBoxPic.bringToFront();
            noteBarPic.bringToFront();
            postItPic.bringToFront();
            backPic1.bringToFront();
            noteHeader.bringToFront();
            message.bringToFront();

            noteCamPic.visible = false;
            notePadPic.visible = false;
            backPic.visible = false;
            camMenuPic.visible = false;
            apps[4][0].appIdx=2;
        }
        else if(isVisible==false){
            noteBarPic.visible=false;
            noteBoxPic.visible=false;
            postItPic.visible=false;
            backPic1.visible=false;
            noteHeader.visible=false;
            message.visible=false;
        }

    }
    else if(menuId==3){
        if(isVisible==true){
            singlePic.visible=true;
            groupPic.visible=true;
            backPic.visible=true;
            camMenuPic.visible=true;
            apps[4][0].appIdx=3;
        }
        else{
            singlePic.visible=false;
            groupPic.visible=false;
            backPic.visible=false;
            camMenuPic.visible=false;
        }


    }
    else if(menuId==4){
        if(isVisible==true){
            circle1.visible=true;
            circle2.visible=true;
            circle3.visible=true;
            leftPic.visible=true;
            rightPic.visible=true;
            camMenuPic.visible = true;
            camMenuPic.top = appPic.top+300;
            apps[4][0].appIdx=4;
        }
        else{
            circle1.visible=false;
            circle2.visible=false;
            circle3.visible=false;
            leftPic.visible=false;
            rightPic.visible=false;
            backPic.visible=false;
            camMenuPic.top = appPic.top;
        }


    }
    else if(menuId==5){
        if(isVisible==true){
            singlePic.visible=true;
            groupPic.visible=true;
            backPic.visible=true;
            camMenuPic.visible=true;
            apps[4][0].appIdx=3;
        }
        else{
            singlePic.visible=false;
            groupPic.visible=false;
            backPic.visible=false;
            camMenuPic.visible=false;
        }
    }

    else{
        if(isVisible==false){
            noteCamPic.visible = false;
            notePadPic.visible = false;
            backPic.visible = false;
            camMenuPic.visible = false;
            noteBarPic.visible=false;
            noteBoxPic.visible=false;
            postItPic.visible=false;
            backPic1.visible=false;
            noteHeader.visible=false;
            message.visible=false;
            singlePic.visible=false;
            groupPic.visible=false;
            circle1.visible=false;
            circle2.visible=false;
            circle3.visible=false;
            backPic.visible=false;
            camMenuPic.top = appPic.top;
        }

    }
}



/*function updateCamPos(){
    backPic.top = appPic.top *1.02;
    peepPic.top = appPic.top;
    peepPic2.top = appPic.top;
    mirrorPic.top = appPic.top;
    mirrorPic2.top = appPic.top;
    camMenuPic.top = appPic.top;
}*/

function updateApps(isVisible){

    if(isVisible==true) {
        weatPic.visible = true;
        calenderPic.visible = true;
        clockPic.visible = true;
        doorCamPic.visible = true;
        notesPic.visible = true;
        homePic.visible = true;
    }
    else {
        weatPic.visible = false;
        calenderPic.visible = false;
        clockPic.visible = false;
        doorCamPic.visible = false;
        notesPic.visible = false;
        homePic.visible = false;

        apps[0].create = false;
        apps[1].create = false;
        apps[2].create = false;
        apps[3].create = false;
        apps[4].create = false;
        apps[5].create = false;
    }
}

function closeApp(name){
    if(name=="doorCam")
        updateCamApp(false,3);
    else if(name=="weather")
        updateWeatApp(false,3);
    else if(name=="notes")
        updateNoteApp(false,0);

}






//---------------------------Ryan's Code End
//--------------------END-CHARMS-BAR-------------------------------


// add all of the elements to the canvas
//canvas.add(charmsBar);
canvas.add(insideDoor);
canvas.add(outsideDoor);
canvas.add(insideHandle);
canvas.add(outsideHandle);


// code adapted from http://jsfiddle.net/tornado1979/39up3jcm/
// this code deals with scaling all the elements on the canvas

function zoomAll(SCALE_FACTOR) {

      var objects = canvas.getObjects();
      for (var i in objects) {
          var scaleX = objects[i].scaleX;
          var scaleY = objects[i].scaleY;
          var left = objects[i].left;
          var top = objects[i].top;

          var tempScaleX = scaleX * SCALE_FACTOR;
          var tempScaleY = scaleY * SCALE_FACTOR;
          var tempLeft = left * SCALE_FACTOR;
          var tempTop = top * SCALE_FACTOR;

          objects[i].scaleX = tempScaleX;
          objects[i].scaleY = tempScaleY;
          objects[i].left = tempLeft;
          objects[i].top = tempTop;

          objects[i].setCoords();
      }
  
      canvas.renderAll();
  }

// draw everything at the appropriate scale for this canvas
zoomAll(canvas.height / localHeight);


</script>

</body>
      
</html>