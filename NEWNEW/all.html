
<!-- template for Project 2 - CS 422 - Spring 2016 - Group 2 -->

<!DOCTYPE html>    
<head>
    <meta charset="utf-8">
    <title>Project 2 - Group 25</title>
  
  <!-- Get version 1.5.0 of Fabric.js from CDN -->
  <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/1.5.0/fabric.min.js" ></script>-->
  <script type="text/javascript" src="offlineFabric.js"></script>
  <script src="weather.js" ></script>


</head>

<body onload="setClock(); setTemp(); setDate();">
    <!-- canvas tag for Fabric.js to draw into -->
    <!-- set this to some appropriate size for your development work -->
    <!-- but keep the same aspect ratio -->
    <!-- we will use width="2714" height="2200" for presentations and evaluation -->
    <div class="canvas-container" style="width: 2714px; height: 2200px; position: relative; -webkit-user-select: none;" >
      <canvas id="c" width="2714" height="2200" style="border: 2px solid black; position: absolute; width: 2714px; height: 2200px; left: 0px; top: 0px; -webkit-user-select: none;" class="lower-canvas" ></canvas>
    </div>

 
<script>
// the aspect ratios given here are not quite tall enough for a 36" x 80" door
// we are assuming bottom 15 inches of the door are not part of the display. 
// that part contains lots of necessary electronics so the bottom of the door
// sits off the bottom of our display wall. You are implementing the interface
// for the top 65" of the display / door
// within the code below I assume I am drawing into a 1220x990 box
// then I can scale the group to whatever size the final canvas is
  var localHeight = 2200;
  var localWidth = 2714;
  var doorWidth = 1235;
  var topLeftInsideDoor = .2 * (localWidth-(2*doorWidth));
  var topLeftOutsideDoor = localWidth - topLeftInsideDoor - doorWidth;
  var charmAppHW = doorWidth / 6;
  var quarterDoorHeight = localHeight / 4;
  var charmOffsetY = (localHeight - (localHeight * .75) - charmAppHW) / 2;
  var charmOffsetX = doorWidth / 18;
  var userOffsetX = charmOffsetX / 2;
  var userOffsetY = charmOffsetY / 2;
  var doorKnobStartY = .47 * localHeight;
  var doorKnobRadius = 75;
  var insideKnobStartX = topLeftInsideDoor + doorWidth - doorKnobRadius - charmOffsetX;
  var outsideKnobStartX = topLeftOutsideDoor + doorKnobRadius + charmOffsetX;
  var userPic, emergencyPic, appPic, settingsPic, weatherPic, devinPic, tomPic, mikePic, mattPic, devinText;
  var canvas = this.__canvas = new fabric.Canvas('c');
  canvas.renderOnAddRemove = false;

  var military = false;
  var celsius = false;
  var userSelect = true;
  var addUserSelect = true;
  var userAdded = false;
;
///---------Start of Ryan's variable declarations\\
  canvas.renderAddRemove=false;
  var URL = 'http://api.openweathermap.org/data/2.5/forecast/city?q=';
  var jsonCity = 'London,uk';
  var apiCode ='&APPID=aa4e2383e2f4acc395aeb12aa81c13ad';
  var groupMsg = [];
  var apps = [];
  var appIdx =0;
  var appSelect = false;
  var messageBody=({active:false,icon:null,msg:'',header:''});
  var videoBody = ({active:false,icon1:null,icon2:null,icon3:null,icon4:null,icon5:null,icon6:null,
    videobody:null,pausePic:null,playPic:null,closePic:null,videoBar:null,videoStrem:null})


  for(i=0;i<6;i++){
      apps.push([]);
  }
apps[0].push({icon:"weather",fp:'resources/weather',active:false,create:false,appIdx:0});
apps[1].push({icon:"clock",fp:'resources/clock',active:false,create:false});
apps[2].push({icon:"calender",fp:'resources/calender',active:false,create:false});
apps[3].push({icon:"doorCam",fp:'resources/doorCam',active:false,create:false});
apps[4].push({icon:"notes",fp:'resources/notes',active:false,create:false,appIdx:0,last:0,isANote:false});
apps[5].push({icon:"home",fp:'resources/home',active:false,create:false});
apps[0].push({icon:"weatMenu",fp:'resources/weatMenu',active:false,create:false});
apps[0].push({icon:"options",fp:'resources/options',active:false,create:false});
apps[0].push({icon:"weathAdd",fp:'resources/weathAdd',active:false,create:false});
apps[0].push({icon:"add",fp:'resources/add',active:false,create:false});
apps[0].push({icon:"back",fp:'resources/back',active:false,create:false,index:0});
apps[3].push({icon:"mirror",fp:'resources/mirror',active:false,create:false});
apps[3].push({icon:"peepCam",fp:'resources/peepCam',active:false,create:false});
apps[3].push({icon:"back",fp:'resources/back',active:false,create:false});
apps[3].push({icon:"bar",fp:'resources/bar',active:false,create:false});
apps[4].push({icon:"noteCam",fp:'resources/noteCam',active:false,create:false});
apps[4].push({icon:"notePad",fp:'resources/notePad',active:false,create:false});
apps[4].push({icon:"noteBox",fp:'resources/noteBox',active:false,create:false});
apps[4].push({icon:"postit",fp:'resources/postit',active:false,create:false});
apps[4].push({icon:"bar2",fp:'resources/bar',active:false,create:false});
apps[4].push({icon:"back1",fp:'resources/back',active:false,create:false});
apps[4].push({icon:"group",fp:'resources/group',active:false,create:false});
apps[4].push({icon:"single",fp:'resources/single',active:false,create:false});
apps[4].push({icon:"left",fp:'resources/left',active:false,create:false});
apps[4].push({icon:"right",fp:'resources/right',active:false,create:false});
apps[4].push({icon:"circle",fp:'resources/circle',active:false,create:false});
apps[4].push({icon:"noteRec",fp:'resources/noteRec',active:false,create:false});
apps[4].push({icon:"rec",fp:'resources/rec',active:false,create:false});
apps[4].push({icon:"rec2",fp:'resources/rec2',active:false,create:false});
apps[4].push({icon:"defaultNote",fp:'resources/defaultRec',active:false,create:false});
//---------------End of Ryan's Variable declartions


//#mikedeclaration #mike
//Mike's variable declarations
  var charmBar = [];
  var charmAppHWs = charmAppHW *.75


  var userType = 1;//registered user is 1 & unregistered users are 0
  var doorState = 2;
  var doAlerts = 0;//dafult no alerts
  var armAlarm = 0;//default unarmed

  var emergency = [];
  var emergencyIdx =0;
  charmBar.push({icon:"emergency",fp:'resources/emergency',active:false,create:false});//currently pushed to position zero in charms bar array should be 1


  for(i=0;i<5;i++){
      emergency.push([]);
  }
  emergency[0].push({icon:"alarm",fp:'resources/alarm',active:false,create:false});
  emergency[1].push({icon:"help",fp:'resources/help',active:false,create:false});
  emergency[2].push({icon:"alerts",fp:'resources/alerts',active:false,create:false});
  emergency[3].push({icon:"password",fp:'resources/tempPass',active:false,create:false});
  emergency[4].push({icon:"back",fp:'resources/back',active:false,create:false});
  //apps[4].push({icon:"notes",fp:'resources/notes',active:false,create:false});
  //apps[5].push({icon:"home",fp:'resources/home',active:false,create:false});

  /*apps[0].push({icon:"weatMenu",fp:'resources/weatMenu',active:false,create:false});
  apps[0].push({icon:"options",fp:'resources/options',active:false,create:false});
  apps[0].push({icon:"weathAdd",fp:'resources/weathAdd',active:false,create:false});
  apps[0].push({icon:"add",fp:'resources/add',active:false,create:false});
  apps[0].push({icon:"back",fp:'resources/back',active:false,create:false,index:0});


  apps[3].push({icon:"mirror",fp:'resources/mirror',active:false,create:false});
  apps[3].push({icon:"peepCam",fp:'resources/peepCam',active:false,create:false});
  apps[3].push({icon:"back",fp:'resources/back',active:false,create:false});
  apps[3].push({icon:"bar",fp:'resources/bar',active:false,create:false});*/




var outsideKnob = [];

for(i=0;i<3;i++){
      outsideKnob.push([]);
  }
outsideKnob[0].push({icon:"key",fp:'resources/keyButton',active:false,create:false});
outsideKnob[1].push({icon:"note",fp:'resources/postIt',active:false,create:false});
outsideKnob[2].push({icon:"chime",fp:'resources/doorBell',active:false,create:false});


var insideKnob = [];

for(i=0;i<6;i++){
      insideKnob.push([]);
  }
insideKnob[0].push({icon:"unlockOpen",fp:'resources/doorunlockedopen',active:false,create:false});
insideKnob[1].push({icon:"lockOpen",fp:'resources/doorlockedopen',active:false,create:false});
insideKnob[2].push({icon:"unlockClose",fp:'resources/doorunlockedclosed',active:false,create:false});
insideKnob[3].push({icon:"lockClose",fp:'resources/doorlockedclosed',active:false,create:false});
insideKnob[4].push({icon:"lock",fp:'resources/invisiButton',active:false,create:false});
insideKnob[5].push({icon:"open",fp:'resources/invisiButton',active:false,create:false});

//</mikedeclarations>


  var userSelect = false;
  // set background to blue to make it easier to see it
  canvas.backgroundColor = "#DDDDDD";  // light grey
// need 36 wide instead of 40 as now
//-------------DEBUG------------------------------
var debug = new fabric.Text("",{  
  left: topLeftOutsideDoor,
  top: 0,
  originX: 'left',
  originY: 'top',
  fontWeight: 'bold',
  shadow: "rgba(0,0,0,0.2) 0px 0px 10px",
  visible: true,
  fontFamily: 'droid serif',
  fontSize: 50,
  lockMovementX: true,
  lockMovementY: true
});
function debugLog()
{
  var log = "";/*"UserIcon:" + userIcon.top + "\n" +
            "UserPic:" + userPic.top + "\n" +
            "AppIcon:" + appIcon.top + "\n" +
            "AppPic:" + appPic.top + "\n" +
            "EmergencyIcon:" + emergencyIcon.top + "\n" +
            "EmergnecyPic:" + emergencyPic.top + "\n" +
            "SettingsIcon:" + settingsIcon.top + "\n" +
            "SettingsPic:" + (getUser('Devin').notes[0] != null ? getUser('Devin').notes[0] : null ) + "\n" +
            "AddUserSelect:" + (addUserSelect ? "true" : "false") + "\n";*/
  debug.setText(log);
}
//---------END-DEBUG------------------------------

function changePic(pic,src)
{
  fabric.util.loadImage(src, function(img) {
    pic.setElement(img);
    pic.width = charmAppHW;
    pic.height = charmAppHW;
    canvas.renderAll();
  }); 
}
//--------Date-and-Time ---------------------------
function setClock()
{
  var today = new Date();
  var h = today.getHours();
  var m = today.getMinutes();
  amPm.setText("");
  if(!military){
    h >= 12 ? amPm.setText("PM") : amPm.setText("AM");
    h = h > 12 ? h - 12 : h;
  }
  m = m < 10 ? "0" + m : m;
  clock.setText(h + ":" + m);
  canvas.renderAll();
  setTimeout(setClock,1000);
}
function setDate()
{
  var today = new Date();
  var d = today.getDate();
  var m = today.getMonth() + 1;
  var y = today.getFullYear();
  date.setText(m + "/" + d + "/" + y);
  canvas.renderAll();
}
var clock = new fabric.Text("",{  
  left: topLeftInsideDoor + (doorWidth * (13/27)),
  top: localHeight/16,
  originX: 'center',
  originY: 'center',
  fontWeight: 'bold',
  shadow: "rgba(0,0,0,0.2) 0px 0px 10px",
  visible: true,
  fontFamily: 'droid serif',
  fontSize: 175,
  lockMovementX: true,
  lockMovementY: true
});
var date = new fabric.Text("",{
  left: topLeftInsideDoor + (doorWidth * (13/27)),
  top: localHeight/8,
  originX: 'center',
  originY: 'center',
  fontWeight: 'bold',
  shadow: "rgba(0,0,0,0.2) 0px 0px 10px",
  visible: true,
  fontFamily: 'droid serif',
  fontSize: 75,
  lockMovementX: true,
  lockMovementY: true
});
var amPm = new fabric.Text("",{
  left: clock.getLeft() + 315,
  top: clock.getTop() + 70,
  originX: 'right',
  originY: 'bottom',
  fontWeight: 'bold',
  shadow: "rgba(0,0,0,0.2) 0px 0px 10px",
  visible: true,
  fontFamily: 'droid serif',
  fontSize: 70,
  lockMovementX: true,
  lockMovementY: true
});
//----END-DATE-AND-TIME----------------------------
//---DOOR-ELEMENTS---------------------------------
var insideDoor = new fabric.Rect({
  left: topLeftInsideDoor,
  top: 0,
  fill: 'white',
  stroke: 'black',
  width: doorWidth,
  height: localHeight,
  angle: 0
});
// the doors will not be selectable or movable
insideDoor.hasControls = insideDoor.hasBorders = false;
insideDoor.lockMovementX = insideDoor.lockMovementY = true;
var outsideDoor = new fabric.Rect({
  left: topLeftOutsideDoor,
  top: 0,
  fill: 'white',
  stroke: 'black',
  width: doorWidth,
  height: localHeight,
  angle: 0
});
outsideDoor.hasControls = outsideDoor.hasBorders = false;
outsideDoor.lockMovementX = outsideDoor.lockMovementY = true;
  
// create a circle for the shower head location
var insideHandle = new fabric.Circle({
  radius: doorKnobRadius, fill: 'grey', left: insideKnobStartX , top: doorKnobStartY,   originX: 'center',
  originY: 'center',
  lockMovementX: true,
  lockMovementY: true 
});
// create a circle for the shower head location
var outsideHandle = new fabric.Circle({
  radius: doorKnobRadius, fill: 'grey', left: outsideKnobStartX, top: doorKnobStartY,   originX: 'center',
  originY: 'center',
  lockMovementX: true,
  lockMovementY: true
});
//--END-DOOR-ELEMENTS---------------------------------
//-----WEATHER----------------------------------------
var weatherIcon = new fabric.Image.fromURL('resources/clouds.png', function(img) {
  img.set({
    left: insideHandle.getLeft(),
    top: 0,
    width: charmAppHW,
    height: charmAppHW,
    originX: 'center',
    originY: 'top',
    visible: true
  });
  canvas.add(img).setActiveObject(img);
  weatherPic = canvas.getActiveObject();
  weatherPic.lockMovementX = true;
  weatherPic.lockMovementY = true;}
);
var degrees = new fabric.Text("72°",{
  left: insideHandle.getLeft(),
  top: localHeight/8,
  originX: 'center',
  originY: 'center',
  fontWeight: 'bold',
  shadow: "rgba(0,0,0,0.2) 0px 0px 10px",
  visible: true,
  fontFamily: 'droid serif',
  fontSize: 70,
  lockMovementX: true,
  lockMovementY: true
});
function setTemp()
{
  celsius ? degrees.setText(degrees.getText() + "C") : degrees.setText(degrees.getText() + "F");
  canvas.renderAll(); 
}
//-----END-WEATHER------------------------------------


function changePic(pic,src)
{
  fabric.util.loadImage(src, function(img) {
    pic.setElement(img);
    pic.width = charmAppHW;
    pic.height = charmAppHW;
    canvas.renderAll();
  }); 
}
/*-----------------------------------------------------------------
* CHARMS BAR
*  -appIcon
*  -emergencyIcon
*  -settingsIcon
*  -userIcon
*///---------------------------------------------------------------
var isDown;
var isUp;
var myVar
var setSwitch;
function myFunction(){isUp = 2;}
var appToggle;

var userIcon = new fabric.Image.fromURL('resources/single.png', function(img) {
  img.set({
    left: topLeftInsideDoor + charmOffsetX,
    top: charmOffsetY,
    width: charmAppHW,
    height: charmAppHW,
    originX: 'left',
    originY: 'top',
    visible: true
  });
  canvas.add(img).setActiveObject(img);
  userPic = canvas.getActiveObject();
  userPic.on('moving', function animate(){
    emergencyPic.top = userPic.getTop() + quarterDoorHeight;
    appPic.top = emergencyPic.getTop() + quarterDoorHeight;
    settingsPic.top = appPic.getTop() + quarterDoorHeight;
    updateEmergencyPos();
    moveUsers();
    updateAppPos();
    //updateCamPos();
    debugLog();
    canvas.renderAll();
  });
  userPic.on('selected', function (){
    if(userSelect){
      addUserPic.top = userPic.top + userPic.height + userOffsetY;
      addUserPic.left = userPic.left + (3 * (userPic.width + userOffsetX));
      changePic(addUserPic,'resources/addUser.png');
      addUserSelect = true;
      showUsers(true);
      showNewUsers(false);
      changePic(userPic,'resources/single2.png');
    }else{
      addUserSelect = false;
      showNewUsers(false);
      showUsers(false);
      changePic(userPic,'resources/single.png');
    }
    userSelect = !userSelect;
    postCharmMove();
    canvas.deactivateAll();
  });
  userPic.on('modified', function (){
    postCharmMove();
  });
  userPic.lockMovementX = true;
  userPic.lockMovementY = false;}
);

/*//leaving this in for quick changes if my merging breaks functionality
var emergencyIcon =  new fabric.Image.fromURL('resources/shield.png', function(img) {
  img.set({
    left: topLeftInsideDoor + charmOffsetX,
    top: quarterDoorHeight + charmOffsetY,
    width: charmAppHW,
    height: charmAppHW,
    originX: 'left',
    originY: 'top',
    visible: true
  });
  canvas.add(img).setActiveObject(img);
  emergencyPic = canvas.getActiveObject();
  emergencyPic.on('selected', function (){
    canvas.deactivateAll();
  });
  emergencyPic.on('moving', function animate(){
    userPic.top = emergencyPic.getTop() - quarterDoorHeight;
     if (appToggle != 1){
    appPic.top = emergencyPic.getTop() + quarterDoorHeight;
    settingsPic.top = appPic.getTop() + quarterDoorHeight;
  }
  else if (appToggle == 1){
     appPic2.top = emergencyPic.getTop() + quarterDoorHeight;
     settingsPic.top = appPic2.getTop() + quarterDoorHeight;
   }
    moveUsers();
    updateAppPos();
    updateCamPos();
    debugLog();
    canvas.renderAll();
  });
  emergencyPic.on('modified', function (){
    postCharmMove();
  });
  emergencyPic.lockMovementX = true; 
  emergencyPic.lockMovementY = false;}
);
*/
//#mikeemergency #mike
var emergencyIcon;
var emergencyPic=0;
function createEmergencyIcon(icon){
    iconPath = icon.fp;
    canvas.remove(emergencyPic);
    if(icon.active==true) {
        iconPath = iconPath + '2';
    }


    console.log(iconPath);

    emergencyIcon = new fabric.Image.fromURL(iconPath +'.png', function(img) {
                if(icon.create==true) {
                    img.set({
                        left: emergencyPic.left,
                        top: emergencyPic.top,
                        width: charmAppHW,
                        height: charmAppHW,
                        originX: 'left',
                        originY: 'top',
                        visible: true
                    });
                }
                else {
                    img.set({
                        left: topLeftInsideDoor + charmOffsetX,
                        top: (quarterDoorHeight) + charmOffsetY,
                        width: charmAppHW,
                        height: charmAppHW,
                        originX: 'left',
                        originY: 'top',
                        visible: true
                    });
                    icon.create = true;
                }
                canvas.add(img).setActiveObject(img);

                emergencyPic = canvas.getActiveObject();
                emergencyPic.on('moving', function(){

                    userPic.top = emergencyPic.getTop() - quarterDoorHeight;
                    canvas.remove(userPic);
                    canvas.add(userPic);
                    appPic.top = emergencyPic.getTop() + quarterDoorHeight;
                    canvas.remove(appPic);
                    canvas.add(appPic);
                    settingsPic.top = appPic.getTop() + quarterDoorHeight;
                    canvas.remove(settingsPic);
                    canvas.add(settingsPic)

                    updateEmergencyPos();
                    moveUsers();
                    updateAppPos();
                    //updateCamPos();
                    debugLog();


                    canvas.deactivateAll();
                });

                emergencyPic.on('selected',function(){
                    console.log("emergencyMenu has been selected");
                    if(charmBar[0].active==true) {
                        charmBar[0].active = false;
                        if(emergency[emergencyIdx][0].active==true){
                            closeEmergency(emergency[emergencyIdx][0].icon);
                            emergency[emergencyIdx][0].active=false;
                        }
                        activeIconE(charmBar[0]);
                        updateEmergency(false);
                        console.log("close emergency menu");
                    }
                    else if(charmBar[0].active==false) {
                        //activeIcon()
                        charmBar[0].active = true;
                        activeIconE(charmBar[0]);
                        console.log("open emergency menu");
                        updateEmergency(true);
                        //updateApps(false);
                    }

                    canvas.deactivateAll();

                })
                emergencyPic.lockMovementX = true;
                emergencyPic.lockMovementY = false;}
    );

}
createEmergencyIcon(charmBar[0]);
//</mikeEmergency>


var isDown;
var isUp;
var myVar
function myFunction(){isUp = 2;}
var lock = false;

var appIcon = new fabric.Image.fromURL('resources/app.png', function(img) {
  img.set({
    left: topLeftInsideDoor + charmOffsetX,
    top: (quarterDoorHeight * 2) + charmOffsetY,
    width: charmAppHW,
    height: charmAppHW,
    originX: 'left',
    originY: 'top',
    visible: true
  });
  canvas.add(img).setActiveObject(img);
  appPic = canvas.getActiveObject();
canvas.on('mouse:up', function(options) {
         if (options.target == appPic){
          clearTimeout(myVar)
        if(isUp == 1 && isDown == 1){
   
        if(charmBar[0].active==true) {
        charmBar[0].active = false;
        if(apps[appIdx][0].active==true){
            closeApp(apps[appIdx][0].icon);
            apps[appIdx][0].active=false;
        }
        changePic(appPic,'resources/app.png');
        closeHomeCal();
       // activeIcon(charmBar[0]);
        updateApps(false);
    }
    else if(charmBar[0].active==false) {
        charmBar[0].active = true;
        changePic(appPic,'resources/app2.png');
        //activeIcon(charmBar[0]);
        updateApps(true);
        showApps();
    }
    canvas.deactivateAll();
  
  }
          }});
canvas.on('mouse:down', function(options) {
         if (options.target == appPic){
          isDown =1;
          isUp = 1;
         myVar =  setTimeout(myFunction, 100)
  }});
  appPic.on('selected', function (){
  });
  appPic.on('moving', function animate(){
    userPic.top = emergencyPic.getTop() - quarterDoorHeight;
    settingsPic.top = appPic.getTop() + quarterDoorHeight;
    emergencyPic.top = appPic.getTop() - quarterDoorHeight;
    moveUsers();
   // updateAppPos();
   // updateCamPos();
    debugLog();
    canvas.renderAll();
  });
  appPic.on('modified', function (){
    postCharmMove();
  });
  appPic.lockMovementX = true;
  appPic.lockMovementY = false;}
);
//createAppIcon(charmBar[0]);

var settingsIcon = new fabric.Image.fromURL('resources/settings.png', function(img) {
  img.set({
    left: topLeftInsideDoor + charmOffsetX,
    top: (quarterDoorHeight * 3) + charmOffsetY,
    width: charmAppHW,
    height: charmAppHW,
    originX: 'left',
    originY: 'top',
    visible: true
  });
  canvas.add(img).setActiveObject(img);
  settingsPic = canvas.getActiveObject();


  canvas.on('mouse:up', function(options) {
         if (options.target == settingsPic){
          clearTimeout(myVar)
        if(isUp == 1 && isDown == 1){
        if (setSwitch==1){
        //if(charmBar[0].active==true) {
        //charmBar[0].active = false;
        //if(apps[appIdx][0].active==true){
          //  closeApp(apps[appIdx][0].icon);
        //    apps[appIdx][0].active=false;
      //  }
        
        closeSettings();
        setSwitch = 0;
      }
       // activeIcon(charmBar[0]);
        //updateApps(false);
    else {
    //else if(charmBar[0].active==false) {
     //   charmBar[0].active = true;
       
        //activeIcon(charmBar[0]);
      //  updateApps(true);
        showSettings();
        setSwitch=1;
      }
    //}
    canvas.deactivateAll();
  
  }
          }});
canvas.on('mouse:down', function(options) {
         if (options.target == settingsPic){
          isDown =1;
          isUp = 1;
         myVar =  setTimeout(myFunction, 100)
  }});

  settingsPic.on('selected', function (){
    canvas.deactivateAll();
  });
  settingsPic.on('moving', function animate(){
    userPic.top = emergencyPic.getTop() - quarterDoorHeight;
    appPic.top = settingsPic.getTop() - quarterDoorHeight;
    emergencyPic.top = appPic.getTop() - quarterDoorHeight;
    updateEmergencyPos();
    moveUsers();
    updateAppPos();
    //updateCamPos();
    debugLog();
    canvas.renderAll();
  });
  settingsPic.on('modified', function (){
    postCharmMove();
  });
  settingsPic.lockMovementX = true;
  settingsPic.lockMovementY = false;}
);

/*function slideDown()
{
  var tempGroup = charmsBar;
  charmsBar = new fabric.Group([ charmsBar[3], charmsBar[0], charmsBar[1], charmsBar[2] ], {
    left: tempGroup.getLeft(),
    top: tempGroup.getTop()
  });
}
function slideUp()
{
  var tempGroup = charmsBar;
  charmsBar = new fabric.Group([ charmsBar[1], charmsBar[2], charmsBar[3], charmsBar[0] ], {
    left: tempGroup.getLeft(),
    top: tempGroup.getTop()
  });
}*/
function moveCharms()
{
  /*if(y < charmAppHW)
  {
    slideUp()
  }
  else if(y > localHeight - charmAppHW)
  {
    slideDown()
  }*/
}

//----------------------------Ryan's Code Start----------------------------------------
/* function activeIcon(app){
     app.create = true;
     if(app.icon ==  'app')
       createAppIcon(app);
     canvas.deactivateAll();
 }*/
function createApps(){
    while(lock);

    createWeather(apps[0][0]);
    createCalender(apps[2][0]);
    createDoorCam(apps[3][0]);
    createNotes(apps[4][0]);
    createHome(apps[5][0]);
    createDoorCamApp();
    createNoteApp();
    createWeatherApp();
    createAppIcons2();
    createdoorlock();

}
createApps();
function createWeatherApp(){
  iconPath = apps[0][1].fp;
  //canvas.remove(weatPic);
  weatherAppMain= new fabric.Image.fromURL(iconPath +'.png', function(img) {
            img.set({left: appPic.left *3, top: appPic.top -200, width: charmAppHW*3, height: charmAppHW+50, originX: 'left',
              originY: 'top', visible: false});
            canvas.add(img).setActiveObject(img);
            createWeatherText();
            weatAppPic = canvas.getActiveObject();
            weatAppPic.lockMovementX = true;
            weatAppPic.lockMovementY = true;}
  );
  iconPath = apps[0][2].fp;
  optionsIcon= new fabric.Image.fromURL(iconPath +'.png', function(img) {
            img.set({left: appPic.left *7, top: appPic.top -190, width: charmAppHW-100, height: charmAppHW-100, originX: 'left',
              originY: 'top', visible: false});
            canvas.add(img).setActiveObject(img);
            optionsPic = canvas.getActiveObject();
            optionsPic.on('selected',function(){
              canvas.deactivateAll();
            })
            optionsPic.lockMovementX = true;
            optionsPic.lockMovementY = true;}
  );
  iconPath = apps[0][4].fp;
  addIcon= new fabric.Image.fromURL(iconPath +'.png', function(img) {
            img.set({left: appPic.left *7, top: appPic.top+80, width: charmAppHW -50, height: charmAppHW -50, originX: 'left',
              originY: 'top', visible: false});
            canvas.add(img).setActiveObject(img);
            addPic = canvas.getActiveObject();
            addPic.on('selected',function(){
              if(apps[0][0].appIdx==1) {
                updateWeatApp(true,2);
                apps[0][0].appIdx = 2;
              }
              else{
                apps[0][0].appIdx = 1;
                var text = searchText.text;
                text = text.trim();
                jsonCity = text;
                json_obj = JSON.parse(get(URL+jsonCity+apiCode));
                updateWeatApp(true,1);
              }
              //var json_obj = JSON.parse(get(URL+city+apiCode));
              canvas.deactivateAll();
            })
            addPic.lockMovementX = true;
            addPic.lockMovementY = true;}
  );
  iconPath = apps[0][5].fp;
  weatBack= new fabric.Image.fromURL(iconPath +'.png', function(img) {
            img.set({left: appPic.left*5.5, top: appPic.top+80, width: charmAppHW -50, height: charmAppHW -50, originX: 'left',
              originY: 'top', visible: false});
            canvas.add(img).setActiveObject(img);
            backPic0 = canvas.getActiveObject();
            backPic0.on('selected',function(){
              if(backPic0.index==2) {
                apps[0][0].appIdx=1;
                updateWeatApp(true, 1);
              }
              else if(backPic0.index==1) {
                apps[0][0].appIdx=0;
                updateWeatApp(false, 3);
              }
              canvas.deactivateAll();
            })
            backPic0.index = 0;
            backPic0.lockMovementX = true;
            backPic0.lockMovementY = true;}
  );
  clouds= new fabric.Image.fromURL('resources/clouds.png', function(img) {
            img.set({left: appPic.left *6.5, top: appPic.top-100, width: charmAppHW-100, height: charmAppHW-100, originX: 'left',
              originY: 'top', visible: false, lockMovementX: true, lockMovementY:true});
            canvas.add(img).setActiveObject(img);
            cloudsPic = canvas.getActiveObject();}
  );
}
var textBuff = ({text:null,active:false,count:0});
var line = [];
function createWeatherText(){
    weatHeader = new fabric.Text("Weather", {left:appPic.left+250,top:appPic.top-200,fontFamily: 'Arial',fill:'white', fontSize: 60, fontWeight: 'italic', originX: 'left',
        originY: 'top',visible:false,selectable:false,evented:false,lockMovementX:true, lockMovementY:true});
    weatHeader2 = new fabric.Text("City List:", {left:appPic.left+250,top:appPic.top-130,fontFamily: 'Arial',fill:'white', fontSize: 40, fontWeight: 'italic', originX: 'left',
        originY: 'top',visible:false,selectable:false,evented:false,lockMovementX:true, lockMovementY:true});
    city = new fabric.Text("Chicago", {left:appPic.left+280,top:appPic.top-80,fontFamily: 'Arial',fill:'black', fontSize: 35, fontWeight: 'italic', originX: 'left',
        originY: 'top',visible:false,selectable:false,evented:false,lockMovementX:true, lockMovementY:true});
    countryOrign = new fabric.Text("Illinois,United States", {left:appPic.left+280,top:appPic.top-40,fontFamily: 'Arial',fill:'black', fontSize: 35, fontWeight: 'italic', originX: 'left',
        originY:'top',visible:false,selectable:false,evented:false,lockMovementX:true, lockMovementY:true});
    time = new fabric.Text("12:58am", {left:appPic.left+280,top:appPic.top,fontFamily: 'Arial',fill:'black', fontSize: 35, fontWeight: 'italic', originX: 'left',
        originY: 'top',visible:false,selectable:false,evented:false,lockMovementX:true, lockMovementY:true});
    temp = new fabric.Text("78", {left:appPic.left*6.8,top:appPic.top,fontFamily: 'Arial',fill:'black', fontSize: 35, fontWeight: 'italic', originX: 'left',
        originY: 'top',visible:false,selectable:false,evented:false,lockMovementX:true, lockMovementY:true});
    degree = new fabric.Text("o", {left:appPic.left*7.2,top:appPic.top-5,fontFamily: 'Arial',fill:'black', fontSize: 24, fontWeight: 'italic', originX: 'left',
        originY: 'top',visible:false,selectable:false,evented:false,lockMovementX:true, lockMovementY:true});
    tempScale = new fabric.Text("F", {left:appPic.left*7.3,top:appPic.top,fontFamily: 'Arial',fill:'black', fontSize: 35, fontWeight: 'italic', originX: 'left',
        originY: 'top',visible:false,selectable:false,evented:false,lockMovementX:true, lockMovementY:true});
    searchText = new fabric.IText("Search City", {left:appPic.left*3.5,top:appPic.top-50, width:5,fontFamily: 'Arial',fill:'black', fontSize: 35, fontWeight: 'italic', originX: 'left',
        originY: 'top',visible:false,lineHeight:1,lockMovementX:true,lockMovementY:true,hasControls:false});
    textBox = new fabric.Rect({left:appPic.left*3.5,top:appPic.top-60,height:charmAppHW-150,width:charmAppHW*2.5,fill:'white',visible:false,hasControls:false,lockMovementX:true,
        lockMovementY:true });
    searchText.entered = false;
    searchText.on('editing:entered',function(){
        if(searchText.entered==false) {
            searchText.text ="   ";
            searchText.entered=true;
        }
    })
   searchText.on('selection:changed',function(){
       //trimText = searchText.text;
       //searchText.text = trimText.trim();
       if(searchText.text.length==25&&textBuff.active==false){
           searchText.text;
           textBuff.text = searchText.text;
          //textBuff.count = 28;
          textBuff.active = true;
       }
        else if(searchText.text.length>=26){
           searchText.text = searchText.text.trim();
           var line=searchText.text[1];
           for(i=2;i<searchText.text.length;i++)
             line = line + searchText.text[i];
           searchText.text = line;
        }
    })
    canvas.add(textBox);
    canvas.add(weatHeader);
    canvas.add(weatHeader2);
    canvas.add(city);
    canvas.add(countryOrign);
    canvas.add(time);
    canvas.add(temp);
    canvas.add(degree);
    canvas.add(tempScale);
    canvas.add(searchText);
}
function createWeather(icon) {
  iconPath = icon.fp;
  weatIcon = new fabric.Image.fromURL(iconPath +'.png', function(img) {
              img.set({
                left: appPic.left *3,top: appPic.top - 200,width: charmAppHW,height: charmAppHW,originX: 'left',
                  originY: 'top', visible: false});
            canvas.add(img).setActiveObject(img);
            weatPic = canvas.getActiveObject();
           weatPic.on('selected',function(){
              updateApps(false);
              updateWeatApp(true,1);
              apps[0][0].active = true;
              appIdx = 0;
              canvas.deactivateAll();
          })
            weatPic.lockMovementX = true;
            weatPic.lockMovementY = true;}
  );
}
function createCalender(icon) {
    iconPath = icon.fp;
    calenderIcon = new fabric.Image.fromURL(iconPath +'.png', function(img) {
                img.set({
                    left: appPic.left *5,top: appPic.top - 200, width: charmAppHW, height: charmAppHW, originX: 'left',
                    originY: 'top', visible: false
                });
                canvas.add(img).setActiveObject(img);
                calenderPic = canvas.getActiveObject();
                     //Change Added///////////////////////////////////////
                  calenderPic.on('selected',function(){
                      apps[2][0].active=true;
                      appIdx = 2;
                    calendarMenu(1);
                    canvas.deactivateAll();
                })
                //Change Ends////////////////////////////////////////
                calenderPic.lockMovementX = true;
                calenderPic.lockMovementY = true;}
    );
}
function createDoorCam(icon) {
    iconPath = icon.fp;
    doorCamIcon = new fabric.Image.fromURL(iconPath +'.png', function(img) {
                img.set({
                    left: appPic.left *3, top: appPic.top *1, width: charmAppHW, height: charmAppHW, originX: 'left',
                    originY: 'top', visible: false
                });
                canvas.add(img).setActiveObject(img);
                doorCamPic = canvas.getActiveObject();
                doorCamPic.on('selected',function(){
                    updateApps(false);
                    updateCamApp(true,4);
                    apps[3][0].active = true;
                    appIdx = 3;
                    canvas.deactivateAll();
                })
                doorCamPic.lockMovementX = true;
                doorCamPic.lockMovementY = true;}
    );
}
function createDoorCamApp(){
  iconPath = apps[3][4].fp;
  camMenubar = new fabric.Image.fromURL(iconPath +'.png', function(img) {
            img.set({
              left: appPic.left *3, top: appPic.top *1.02, width: charmAppHW*3.3, height: charmAppHW-80, originX: 'left',
              originY: 'top', visible: false,lockMovementX:true,lockMovementY:true
            });
            canvas.add(img).setActiveObject(img);
            camMenuPic = canvas.getActiveObject();}
  );
  iconPath = apps[3][1].fp;
  mirrorIcon = new fabric.Image.fromURL(iconPath +'.png', function(img) {
            img.set({
              left: appPic.left *3, top: appPic.top *1, width: charmAppHW, height: charmAppHW, originX: 'left',
              originY: 'top', visible: false,lockMovementX:true,lockMovementY:true
            });
            canvas.add(img).setActiveObject(img);
            mirrorPic = canvas.getActiveObject();
            mirrorPic.on('selected',function(){updateCamApp(true,1);canvas.deactivateAll();})
          }
  );
  mirrorIcon2 = new fabric.Image.fromURL(iconPath +2+'.png', function(img) {
            img.set({
              left: appPic.left *3, top: appPic.top *1, width: charmAppHW, height: charmAppHW, originX: 'left',
              originY: 'top', visible: false,lockMovementX:true,lockMovementY:true});
            canvas.add(img).setActiveObject(img);
            mirrorPic2 = canvas.getActiveObject();
            mirrorPic2.on('selected',function(){updateCamApp(false,1);canvas.deactivateAll();})
          }
  );
  iconPath = apps[3][2].fp;
  peepIcon = new fabric.Image.fromURL(iconPath +'.png', function(img) {
            img.set({
              left: appPic.left *5, top: appPic.top *1, width: charmAppHW, height: charmAppHW, originX: 'left',
              originY: 'top', visible: false,lockMovementX:true,lockMovementY:true});
            canvas.add(img).setActiveObject(img);
            peepPic = canvas.getActiveObject();
            peepPic.on('selected',function(){updateCamApp(true,2);canvas.deactivateAll();})
          }
  );
  iconPath = apps[3][2].fp;
  peepIcon2 = new fabric.Image.fromURL(iconPath +'2'+'.png', function(img) {
            img.set({
              left: appPic.left *5, top: appPic.top *1, width: charmAppHW, height: charmAppHW, originX: 'left',
              originY: 'top', visible: false,lockMovementX:true,lockMovementY:true});
            canvas.add(img).setActiveObject(img);
            peepPic2 = canvas.getActiveObject();
            peepPic2.on('selected',function(){updateCamApp(false,2);canvas.deactivateAll();})}
  );
  iconPath = apps[3][3].fp;
  backIcon = new fabric.Image.fromURL(iconPath +'.png', function(img) {
            img.set({
              left: appPic.left *7, top: appPic.top *1, width: charmAppHW, height: charmAppHW, originX: 'left',
              originY: 'top', visible: false,lockMovementX:true,lockMovementY:true});
            canvas.add(img).setActiveObject(img);
            backPic = canvas.getActiveObject();
            backPic.on('selected',function(){
              if(appIdx==3) {
                updateCamApp(false, 3);
                apps[3][0].active = false;
              }
              else if(appIdx==4){
                if(apps[4][0].appIdx==3&& apps[4][0].last==2){
                  updateNoteApp(false, 3);
                  updateNoteApp(true,2);
                  //updateApps(true);
                  apps[4][0].appIdx = 2;
                }
                else if( apps[4][0].appIdx==3&&apps[4][0].last==6){
                  updateNoteApp(false,3);
                  updateNoteApp(true,6);
                }
                else if(apps[4][0].appIdx==6&&apps[4][0].last==1){
                  updateNoteApp(false,6);
                  updateNoteApp(true,1);
                }
                else {
                  updateNoteApp(false, 0);
                  updateApps(true);
                  apps[4][0].appIdx=0;
                  apps[4][0].active = false;
                }
              }
            canvas.deactivateAll();})
            backPic.lockMovementX = true;
            backPic.lockMovementY = true;}
  );
  outsideBG = new fabric.Image.fromURL('resources/outside.png', function(img) {
            img.set({
              left:topLeftInsideDoor, top:0, width:doorWidth, height:localHeight, originX: 'left',
              originY: 'top', visible: false,lockMovementX:true,lockMovementY:true
            });
            canvas.add(img).setActiveObject(img);
            outSideBGPic = canvas.getActiveObject();
            outSideBGPic.sendToBack();
            outSideBGPic.bringForward();
          }
  );
    insideBG = new fabric.Image.fromURL('resources/inside.jpg', function(img) {
                img.set({
                    left:topLeftInsideDoor, top:0, width:doorWidth, height:localHeight, originX: 'left',
                    originY: 'top', visible: false,lockMovementX:true,lockMovementY:true
                });
                canvas.add(img).setActiveObject(img);
                insideBGPic = canvas.getActiveObject();
                insideBGPic.sendToBack();
                insideBGPic.bringForward();
            }
    );
}
function createNoteApp(){
  iconPath = apps[4][1].fp;
  noteCamIcon = new fabric.Image.fromURL(iconPath +'.png', function(img) {
            img.set({left: appPic.left *3 , top: appPic.top *1, width: charmAppHW, height: charmAppHW,
              originX: 'left', originY: 'top', visible: false,lockMovementX:true,lockMovementY:true
            });
            canvas.add(img).setActiveObject(img);
            noteCamPic = canvas.getActiveObject();
            noteCamPic.on('selected',function(){
              updateNoteApp(false,0);
              updateNoteApp(true,6);
              canvas.deactivateAll();
            })
          }
  );
  iconPath = apps[4][2].fp;
  notePadIcon = new fabric.Image.fromURL(iconPath +'.png', function(img) {
            img.set({left: appPic.left *5 , top: appPic.top *1, width: charmAppHW, height: charmAppHW,
              originX: 'left', originY: 'top', visible: false,lockMovementX:true,lockMovementY:true
            });
            canvas.add(img).setActiveObject(img);
            notePadPic = canvas.getActiveObject();
            notePadPic.on('selected',function(){
              apps[4][0].isANote = true;
              updateNoteApp(true,2);
              canvas.deactivateAll();
            })
          }
  );
  iconPath = apps[4][3].fp;
  noteBoxIcon = new fabric.Image.fromURL(iconPath +'.png', function(img) {
            img.set({left: appPic.left *4 , top: appPic.top -200, width: charmAppHW+300, height: charmAppHW+400,
              originX: 'left', originY: 'top', visible: false,lockMovementX:true,lockMovementY:true
            });
            canvas.add(img).setActiveObject(img);
            noteBoxPic = canvas.getActiveObject();
            noteAppText();
          }
  );
  iconPath = apps[4][5].fp;
  noteBarIcon = new fabric.Image.fromURL(iconPath +'.png', function(img) {
            img.set({left: appPic.left*4.2 , top: appPic.top-160, width:charmAppHW, height: charmAppHW-130,
              originX: 'left', originY: 'top', visible: false,lockMovementX:true,lockMovementY:true
            });
            canvas.add(img).setActiveObject(img);
            noteBarPic = canvas.getActiveObject();
          }
  );
  iconPath = apps[4][4].fp;
  postItIcon = new fabric.Image.fromURL(iconPath +'.png', function(img) {
            img.set({left: appPic.left *4.1 , top: appPic.top -170, width: charmAppHW-100, height: charmAppHW-100,
              originX: 'left', originY: 'top', visible: false,lockMovementX:true,lockMovementY:true
            });
            canvas.add(img).setActiveObject(img);
            postItPic = canvas.getActiveObject();
            postItPic.on('selected',function(){
              updateNoteApp(false,2);
              updateNoteApp(true,3);
              canvas.deactivateAll();
            })
          }
  );
  iconPath = apps[4][6].fp;
  backIcon1 = new fabric.Image.fromURL(iconPath +'.png', function(img) {
            img.set({left: appPic.left *5.2 , top: appPic.top -170, width:charmAppHW-100, height: charmAppHW-100,
              originX: 'left', originY: 'top', visible: false,lockMovementX:true,lockMovementY:true
            });
            canvas.add(img).setActiveObject(img);
            backPic1 = canvas.getActiveObject();
            backPic1.on('selected',function(){
              updateNoteApp(false,2)
              updateNoteApp(true,1);
              canvas.deactivateAll();
            })
          }
  );
  iconPath = apps[4][7].fp;
  groupIcon = new fabric.Image.fromURL(iconPath +'.png', function(img) {
            img.set({left: appPic.left *3 , top: appPic.top *1, width: charmAppHW-20, height: charmAppHW-20,
              originX: 'left', originY: 'top', visible:false,lockMovementX:true,lockMovementY:true
            });
            canvas.add(img).setActiveObject(img);
            groupPic = canvas.getActiveObject();
            groupPic.on('selected',function(){
              updateNoteApp(false,3);
                updateNoteApp(false,3);
                if(apps[4][0].isANote==true) {
                    if (messageBody.active == true) {
                        canvas.remove(msgHead);
                        canvas.remove(msgBody);
                        canvas.remove(closePic);
                        canvas.remove(messageBodyPic);
                    }
                    groupMsg.push({header: noteHeader.text, msg: message.text});
                    apps[4][0].isANote=false;
                    createMessage();
                }
                else {
                    createVideoMessage();
                }
              canvas.deactivateAll();
            })
          }
  );
  iconPath = apps[4][8].fp;
  singleIcon = new fabric.Image.fromURL(iconPath +'.png', function(img) {
            img.set({left: appPic.left *5 , top: appPic.top *1, width: charmAppHW-20, height: charmAppHW-20,
              originX: 'left', originY: 'top', visible: false,lockMovementX:true,lockMovementY:true
            });
            canvas.add(img).setActiveObject(img);
            singlePic = canvas.getActiveObject();
            singlePic.on('selected',function(){
              updateNoteApp(false,3);
              updateNoteApp(true,4);
              canvas.deactivateAll();
            })
          }
  );
  iconPath = apps[4][9].fp;
  leftIcon = new fabric.Image.fromURL(iconPath +'.png', function(img) {
            img.set({left: appPic.left, top: appPic.top+270, width: charmAppHW, height: charmAppHW,
              originX: 'left', originY: 'top', visible: false,lockMovementX:true,lockMovementY:true
            });
            canvas.add(img).setActiveObject(img);
            leftPic = canvas.getActiveObject();
            leftPic.on('selected',function(){
              //updateNoteApp(true,5);
              canvas.deactivateAll();
            })
          }
  );
  iconPath = apps[4][10].fp;
  rightIcon = new fabric.Image.fromURL(iconPath +'.png', function(img) {
            img.set({left: appPic.left*9 , top: appPic.top+250, width: charmAppHW, height: charmAppHW,
              originX: 'left', originY: 'top', visible: false,lockMovementX:true,lockMovementY:true
            });
            canvas.add(img).setActiveObject(img);
            rightPic = canvas.getActiveObject();
            rightPic.on('selected',function(){
              //updateNoteApp(true,5);
              canvas.deactivateAll();
            })
          }
  );
  iconPath = apps[4][11].fp;
  circleIcon = new fabric.Image.fromURL(iconPath +'.png', function(img) {
            img.set({left: appPic.left *3 , top: appPic.top+250, width: charmAppHW, height: charmAppHW,
              originX: 'left', originY: 'top', visible:false,lockMovementX:true,lockMovementY:true
            });
            canvas.add(img).setActiveObject(img);
            circle1 = canvas.getActiveObject();
            circle1.on('selected',function(){
              updateNoteApp(false,4);
              updateNoteApp(false,1);
              canvas.deactivateAll();
            })
          }
  );
  circleIcon2 = new fabric.Image.fromURL(iconPath +'.png', function(img) {
            img.set({left: appPic.left *5 , top: appPic.top+250, width: charmAppHW, height: charmAppHW,
              originX: 'left', originY: 'top', visible:false,lockMovementX:true,lockMovementY:true
            });
            canvas.add(img).setActiveObject(img);
            circle2 = canvas.getActiveObject();
            circle2.on('selected',function(){
              updateNoteApp(false,4);
              updateNoteApp(false,1);
              canvas.deactivateAll();
            })
          }
  );
  circleIcon3 = new fabric.Image.fromURL(iconPath +'.png', function(img) {
            img.set({left: appPic.left *7 , top: appPic.top+250, width: charmAppHW, height: charmAppHW,
              originX: 'left', originY: 'top', visible:false,lockMovementX:true,lockMovementY:true
            });
            canvas.add(img).setActiveObject(img);
            circle3 = canvas.getActiveObject();
            circle3.on('selected',function(){
              updateNoteApp(false,4);
              updateNoteApp(false,1);
              canvas.deactivateAll();
            })
          }
  );
  iconPath = apps[3][4].fp;
  recBar = new fabric.Image.fromURL(iconPath +'.png', function(img) {
            img.set({left: appPic.left*4, top: appPic.top+50, width: charmAppHW*2, height: charmAppHW-100, originX: 'left',
              originY: 'top', visible: false,lockMovementX:true,lockMovementY:true});
            canvas.add(img).setActiveObject(img);
            recBarPic = canvas.getActiveObject();
          }
  );
  iconPath = apps[4][12].fp;
  recNoteIcon = new fabric.Image.fromURL(iconPath +'.png', function(img) {
            img.set({left: appPic.left*4, top: appPic.top-400, width: charmAppHW*2, height: charmAppHW*2, originX: 'left',
              originY: 'top', visible: false,lockMovementX:true,lockMovementY:true});
            canvas.add(img).setActiveObject(img);
            recNotePic = canvas.getActiveObject();
            blackBox = new fabric.Rect({left:recNotePic.left+30, top:recNotePic.top+80,width:charmAppHW+150,height:charmAppHW+110,
              originX:'left',originY:'top',visible:false,lockMovementX:true,lockMovementY:true});
            canvas.add(blackBox);
            recNotePic.on('selected',function(){
              updateNoteApp(false,6);
              updateNoteApp(true,3);
              canvas.deactivateAll();
            })
          }
  );
  iconPath = apps[4][13].fp;
  recIcon = new fabric.Image.fromURL(iconPath +'.png', function(img) {
            img.set({left: appPic.left*5.5, top: appPic.top+10, width: charmAppHW -40, height: charmAppHW -40, originX: 'left',
              originY: 'top', visible: false,lockMovementX:true,lockMovementY:true});
            canvas.add(img).setActiveObject(img);
            recPic = canvas.getActiveObject();
            recPic.on('selected',function(){
              recPic2.visible=true;
              recPic.visible=false;
              blackBox.visible=false;
              defaultNotePic.visible=true;
              canvas.deactivateAll();
            })
          }
  );
  iconPath = apps[4][14].fp;
  recIcon2 = new fabric.Image.fromURL(iconPath +'.png', function(img) {
            img.set({left: appPic.left*5.5, top: appPic.top+10, width: charmAppHW -40, height: charmAppHW -40, originX: 'left',
              originY: 'top', visible: false,lockMovementX:true,lockMovementY:true});
            canvas.add(img).setActiveObject(img);
            recPic2 = canvas.getActiveObject();
            recPic2.on('selected',function(){
              blackBox.visible=true;
              recPic.visible=true;
              recPic2.visible=false;
              defaultNotePic.visible=false;
              canvas.deactivateAll();
            })
          }
  );
  iconPath = apps[4][4].fp;
  postItIcon2 = new fabric.Image.fromURL(iconPath +'.png', function(img) {
            img.set({left: appPic.left *3.5 , top: appPic.top+10, width: charmAppHW, height: charmAppHW,
              originX: 'left', originY: 'top', visible: false,lockMovementX:true,lockMovementY:true
            });
            canvas.add(img).setActiveObject(img);
            postItPic2 = canvas.getActiveObject();
            postItPic2.on('selected',function(){
              updateNoteApp(false,6);
              updateNoteApp(true,3);
              canvas.deactivateAll();
            })
          }
  );
  iconPath = apps[4][15].fp;
  defaultNote = new fabric.Image.fromURL(iconPath +'.png', function(img) {
            img.set({left: recNotePic.left+30, top: recNotePic.top+80, width: charmAppHW+150, height: charmAppHW+110, originX: 'left',
              originY: 'top', visible: false,lockMovementX:true,lockMovementY:true});
            canvas.add(img).setActiveObject(img);
            defaultNotePic = canvas.getActiveObject();
            canvas.add(blackBox);
          }
  );
}
function noteAppText(){
    noteHeader = new fabric.Text("New Note", {left:appPic.left+380,top:appPic.top-80,fontFamily: 'Arial',fill:'black', fontSize: 40, fontWeight: 'italic', originX: 'left',
        originY: 'top',visible:false,selectable:false,evented:false,lockMovementX:true, lockMovementY:true});
    canvas.add(noteHeader);
    message = new fabric.IText("Add Note",{left:appPic.left+380,top:appPic.top-30, width:5,fontFamily: 'Arial',fill:'black', fontSize: 34, fontWeight: 'italic', originX: 'left',
        originY: 'top',visible:false,lineHeight:1,lockMovementX:true,lockMovementY:true,hasControls:false});
    canvas.add(message);
    message.entered=false;
    message.on('editing:entered',function(){
        if(message.entered==false) {
            message.text ="   ";
            message.entered=true;
        }
    })
}
function createNotes(icon) {
    iconPath = icon.fp;
    notesIcon = new fabric.Image.fromURL(iconPath +'.png', function(img) {
                img.set({
                    left: appPic.left *5,top: appPic.top * 1,width: charmAppHW, height: charmAppHW,
                    originX: 'left', originY: 'top', visible: false, lockMovementX:true,lockMovementY:true
                });
                canvas.add(img).setActiveObject(img);
                notesPic = canvas.getActiveObject();
                notesPic.on('selected',function(){
                    apps[4][0].active=true;
                    appIdx=4;
                    updateNoteApp(true,1);
                    canvas.deactivateAll();
                })
            });
}
function createHome(icon) {
    iconPath = icon.fp;
    homeIcon = new fabric.Image.fromURL(iconPath +'.png', function(img) {
                img.set({left: appPic.left *7, top: appPic.top -200, width: charmAppHW, height: charmAppHW, originX: 'left',
                    originY: 'top', visible: false,lockMovementX:true,lockMovementY:true});
                canvas.add(img).setActiveObject(img);
                homePic = canvas.getActiveObject();
                //Change Added///////////////////////////////////////
                  homePic.on('selected',function(){
                    apps[5][0].active=true;
                    appIdx = 5;
                    homeMenu(1);
                    canvas.deactivateAll();
                })
                //Change Ends////////////////////////////////////////
            }
    );
}
function updateAppPos(){
    weatPic.top = appPic.top - 200;
    canvas.remove(weatPic);
    canvas.add(weatPic);
    calenderPic.top = appPic.top - 200;
    canvas.remove(calenderPic);
    canvas.add(calenderPic);
    doorCamPic.top = appPic.top;
    canvas.remove(doorCamPic);
    canvas.add(doorCamPic);
    notesPic.top = appPic.top;
    canvas.remove(notesPic);
    canvas.add(notesPic);
    homePic.top = appPic.top;
    canvas.remove(homePic);
    canvas.add(homePic);
     //Change Added///////////////////////////////////////
    homePic2.top = appPic.top-500;
    canvas.remove(homePic2);
    canvas.add(homePic2);
    lightpic.top = appPic.top;
    canvas.remove(lightpic);
    canvas.add(lightpic);
    homeLockPic.top = appPic.top;
    canvas.remove(homeLockPic);
    canvas.add(homeLockPic);
    homeLockPic2.top = appPic.top-500;
    canvas.remove(homeLockPic2);
    canvas.add(homeLockPic2);
    thermPic.top = appPic.top;
    canvas.remove(thermPic);
    canvas.add(thermPic);
    thermPic2.top = appPic.top-500;
    canvas.remove(thermPic2);
    canvas.add(thermPic2);
    homeBackPic.top = appPic.top+200;
    canvas.remove(homeBackPic);
    canvas.add(homeBackPic);
     tempBackPic.top = appPic.top+300;
    canvas.remove(tempBackPic);
    canvas.add(tempBackPic);
    tempAdjPic.top = appPic.top+300;
    canvas.remove(tempAdjPic);
    canvas.add(tempAdjPic);
    unlockPic1.top = appPic.top-200;
    canvas.remove(unlockPic1);
    canvas.add(unlockPic1);
      unlockPic2.top = appPic.top-50;
    canvas.remove(unlockPic2);
    canvas.add(unlockPic2);
      unlockPic3.top = appPic.top+100;
    canvas.remove(unlockPic3);
    canvas.add(unlockPic3);
      unlockPic4.top = appPic.top+250;
    canvas.remove(unlockPic4);
    canvas.add(unlockPic4);
  
    homeDoorPic.top = appPic.top+400;
    canvas.remove(homeDoorPic);
    canvas.add(homeDoorPic);
    lockBackPic.top = appPic.top+400;
    canvas.remove(lockBackPic);
    canvas.add(lockBackPic);
    
    lockPic1.top = appPic.top-200;
    canvas.remove(lockPic1);
    canvas.add(lockPic1);
    lockPic2.top = appPic.top-50;
    canvas.remove(lockPic2);
    canvas.add(lockPic2);
    lockPic3.top = appPic.top+100;
    canvas.remove(lockPic3);
    canvas.add(lockPic3);
    lockPic4.top = appPic.top+250;
    canvas.remove(lockPic4);
    canvas.add(lockPic4);
     lightpic2.top = appPic.top-500;
    canvas.remove(lightpic2);
    canvas.add(lightpic2);
    lightOnPic1.top = appPic.top-200;
    canvas.remove(lightOnPic1);
    canvas.add(lightOnPic1);
    lightOnPic2.top = appPic.top-50;
    canvas.remove(lightOnPic2);
    canvas.add(lightOnPic2);
    lightOnPic3.top = appPic.top+100;
    canvas.remove(lightOnPic3);
    canvas.add(lightOnPic3);
    lightOnPic4.top = appPic.top+250;
    canvas.remove(lightOnPic4);
    canvas.add(lightOnPic4);
    lightOnPic5.top = appPic.top+400;
    canvas.remove(lightOnPic5);
    canvas.add(lightOnPic5);
      lightOffPic1.top = appPic.top-200;
    canvas.remove(lightOffPic1);
    canvas.add(lightOffPic1);
    lightOffPic2.top = appPic.top-50;
    canvas.remove(lightOffPic2);
    canvas.add(lightOffPic2);
    lightOffPic3.top = appPic.top+100;
    canvas.remove(lightOffPic3);
    canvas.add(lightOffPic3);
    lightOffPic4.top = appPic.top+250;
    canvas.remove(lightOffPic4);
    canvas.add(lightOffPic4);
    lightOffPic5.top = appPic.top+400;
    canvas.remove(lightOffPic5);
    canvas.add(lightOffPic5);
    homeLightPic.top = appPic.top+550;
    canvas.remove(homeLightPic);
    canvas.add(homeLightPic);
     lightBackPic.top = appPic.top+550;
    canvas.remove(lightBackPic);
    canvas.add(lightBackPic);
    calendarPic2.top = appPic.top-500;
    canvas.remove(calendarPic2);
    canvas.add(calendarPic2);
    monthPic2.top = appPic.top-500;
    canvas.remove(monthPic2);
    canvas.add(monthPic2);
    toDoPic2.top = appPic.top-500;
    canvas.remove(toDoPic2);
    canvas.add(toDoPic2);
    toDoBackPic.top = appPic.top+500;
    canvas.remove(toDoBackPic);
    canvas.add(toDoBackPic);
    monthBackPic.top = appPic.top+500;
    canvas.remove(monthBackPic);
    canvas.add(monthBackPic);
    monthPic.top = appPic.top;
    canvas.remove(monthPic);
    canvas.add(monthPic);
    toDoPic.top = appPic.top;
    canvas.remove(toDoPic);
    canvas.add(toDoPic);
     calendarBackPic.top = appPic.top+200;
    canvas.remove(calendarBackPic);
    canvas.add(calendarBackPic);
    listPic.top = appPic.top-200;
    canvas.remove(listPic);
    canvas.add(listPic);
     fullMonthPic.top = appPic.top-200;
    canvas.remove(fullMonthPic);
    canvas.add(fullMonthPic);
    //Change Ends////////////////////////////////////////
}
function updateCamApp(isVisible,menuId){
  mirrorPic2.bringToFront();
  mirrorPic.bringToFront();
  peepPic.bringToFront();
  peepPic2.bringToFront();
  backPic.bringToFront();
  if(menuId==1){
    if(isVisible==true) {
      apps[3][1].active=true;
      mirrorPic2.visible = true;
      mirrorPic.visible = false;
      peepPic2.visible = false;
      peepPic.visible = true;
      insideBGPic.visible=true;
    }
    else {
      apps[3][1].active = false;
      mirrorPic2.visible = false;
      mirrorPic.visible = true;
      insideBGPic.visible = false;
    }
  }
  else if(menuId==2){
    if(isVisible==true) {
      apps[3][2].active=true;
      peepPic2.visible = true;
      peepPic.visible = false;
      mirrorPic2.visible = false;
      mirrorPic.visible = true;
      outSideBGPic.visible = true;
    }
    else {
      apps[3][2].active = false;
      peepPic2.visible = false;
      peepPic.visible = true;
      outSideBGPic.visible=false;
    }
  }
  else if(menuId==3){
    updateApps(true);
    if(isVisible==false) {
      backPic.visible = false;
      peepPic.visible = false;
      peepPic2.visible = false;
      mirrorPic.visible = false;
      mirrorPic2.visible = false;
      camMenuPic.visible = false;
    }
  }
  else{
    if(isVisible==true){
      camMenuPic.visible = true;
      peepPic.visible = true;
      backPic.visible = true;
      mirrorPic.visible = true;
    }
  }
}
function updateWeatApp(isVisible,menuId){
  if(menuId==1){
    if(isVisible==true) {
      apps[0][1].active=true;
      weatAppPic.visible = true;
      optionsPic.visible = true;
      addPic.visible = true;
      backPic0.visible = true;
      weatHeader.visible = true;
      weatHeader2.visible=true;
      weatHeader2.text = "City List:";
      city.visible=true;
      countryOrign.visible=true;
      time.visible=true;
      temp.visible=true;
      degree.visible=true;
      tempScale.visible=true;
      cloudsPic.visible=true;
      searchText.visible=false;
      textBox.visible=false;
      searchText.entered=false;
      searchText.text="Search Cities";
      backPic0.index = 1;
    }
  }
  else if(menuId==2){
    if(isVisible==true) {
      weatHeader2.text = "Add a city:";
      optionsPic.visible = false;
      addPic.visible=true;
      textBox.visible=true;
      city.visible = false;
      countryOrign.visible=false;
      time.visible = false;
      temp.visible =false;
      degree.visible=false;
      tempScale.visible=false;
      searchText.visible=true;
      cloudsPic.visible=false;
      backPic0.index = 2;
    }
  }
  else if(menuId==3){
    updateApps(true);
    if(isVisible==false) {
      backPic0.index = 0;
      apps[0][1].active=false;
      weatAppPic.visible = false;
      optionsPic.visible = false;
      addPic.visible = false;
      backPic0.visible=false;
      weatHeader.visible = false;
      weatHeader2.visible=false;
      weatHeader2.text = "City List:";
      city.visible=false;
      countryOrign.visible=false;
      time.visible=false;
      temp.visible=false;
      degree.visible=false;
      tempScale.visible=false;
      searchText.visible=false;
      cloudsPic.visible=false;
    }
  }
}
function updateNoteApp(isVisible,menuId){
  if(menuId==1){
    if(isVisible==true) {
      updateApps(false);
      noteCamPic.visible = true;
      notePadPic.visible = true;
      backPic.visible = true;
      camMenuPic.visible = true;
      noteCamPic.bringToFront();
      notePadPic.bringToFront();
      backPic.bringToFront();
      temp =  apps[4][0].appIdx;
      apps[4][0].appIdx=1;
      apps[4][0].last=temp;
    }
    else if(isVisible==false){
      noteCamPic.visible = false;
      notePadPic.visible = false;
      backPic.visible = false;
      camMenuPic.visible = false;
    }
  }
  else if(menuId==2){
    if(isVisible==true) {
        noteBarPic.visible = true;
        noteBoxPic.visible = true;
        postItPic.visible = true;
        backPic1.visible = true;
        noteHeader.visible = true;
        noteHeader.text="New Note"
        message.visible = true;
        message.text="Add Note"

        noteBoxPic.bringToFront();
        noteBarPic.bringToFront();
        postItPic.bringToFront();
        backPic1.bringToFront();
        noteHeader.bringToFront();
        message.bringToFront();

        noteCamPic.visible = false;
        notePadPic.visible = false;
        backPic.visible = false;
        camMenuPic.visible = false;
        temp =  apps[4][0].appIdx;
        apps[4][0].appIdx=2;
        apps[4][0].last=temp;
    }
    else if(isVisible==false){
      noteBarPic.visible=false;
      noteBoxPic.visible=false;
      postItPic.visible=false;
      postItPic2.visible=false;
      backPic1.visible=false;
      noteHeader.visible=false;
      message.visible=false;
    }
  }
  else if(menuId==3){
    if(isVisible==true){
      singlePic.visible=true;
      groupPic.visible=true;
      backPic.visible=true;
      camMenuPic.visible=true;
      camMenuPic.width= charmAppHW*3.1;
      temp =  apps[4][0].appIdx;
      apps[4][0].appIdx=3;
      apps[4][0].last=temp;
      singlePic.bringToFront();
      groupPic.bringToFront();
      backPic.bringToFront();
    }
    else{
      singlePic.visible=false;
      groupPic.visible=false;
      backPic.visible=false;
      camMenuPic.width= charmAppHW*3.3;
      camMenuPic.visible=false;
    }
  }
  else if(menuId==4){
    if(isVisible==true){
      circle1.visible=true;
      circle2.visible=true;
      circle3.visible=true;
      leftPic.visible=true;
      rightPic.visible=true;
      circle1.bringToFront();
      circle2.bringToFront();
      circle3.bringToFront();
      leftPic.bringToFront();
      rightPic.bringToFront();
      camMenuPic.visible = true;
      camMenuPic.top = appPic.top+300;
      temp =  apps[4][0].appIdx;
      apps[4][0].appIdx=4;
      apps[4][0].last=temp;
    }
    else{
      circle1.visible=false;
      circle2.visible=false;
      circle3.visible=false;
      leftPic.visible=false;
      rightPic.visible=false;
      backPic.visible=false;
      camMenuPic.top = appPic.top*1.02;
    }
  }
  else if(menuId==5){
    if(isVisible==true){
      singlePic.visible=true;
      groupPic.visible=true;
      backPic.visible=true;
      camMenuPic.visible=true;
      singlePic.bringToFront();
      groupPic.bringToFront();
      backPic.bringToFront();
      temp =  apps[4][0].appIdx;
      apps[4][0].appIdx=3;
      apps[4][0].last=temp;
    }
    else{
      singlePic.visible=false;
      groupPic.visible=false;
      backPic.visible=false;
      camMenuPic.visible=false;
    }
  }
  else if(menuId==6){
    if(isVisible==true){
      recBarPic.visible=true;
      recNotePic.visible=true;
      recPic.visible=true;
      backPic.visible=true;
      blackBox.visible=true;
      recPic.bringToFront();
      backPic.bringToFront();
      recNotePic.bringToFront();
      blackBox.bringToFront();
      defaultNotePic.bringToFront();
      postItPic2.visible=true;
      temp =  apps[4][0].appIdx;
      apps[4][0].appIdx=6;
      apps[4][0].last=temp;
    }
    else{
      recBarPic.visible=false;
      recNotePic.visible=false;
      recPic.visible=false;
      backPic.visible=false;
      recPic2.visible=false;
      postItPic2.visible=false;
      blackBox.visible=false;
      defaultNotePic.visible=false;
    }
  }
  else{
    if(isVisible==false){
      noteCamPic.visible = false;
      notePadPic.visible = false;
      backPic.visible = false;
      camMenuPic.visible = false;
      noteBarPic.visible=false;
      noteBoxPic.visible=false;
      postItPic.visible=false;
      backPic1.visible=false;
      noteHeader.visible=false;
      message.visible=false;
      singlePic.visible=false;
      groupPic.visible=false;
      circle1.visible=false;
      circle2.visible=false;
      circle3.visible=false;
      backPic.visible=false;
      recBarPic.visible=false;
      recNotePic.visible=false;
      recPic.visible=false;
      recPic2.visible=false;
      camMenuPic.top = appPic.top*1.02;
      postItPic2.visible=false;
      blackBox.visible=false;
      defaultNotePic.visible=false;
    }
  }
}
/*function updateCamPos(){
    backPic.top = appPic.top *1.02;
    peepPic.top = appPic.top;
    peepPic2.top = appPic.top;
    mirrorPic.top = appPic.top;
    mirrorPic2.top = appPic.top;
    camMenuPic.top = appPic.top;
}*/
function updateApps(isVisible){
    if(isVisible==true) {
        weatPic.visible = true;
        calenderPic.visible = true;
        doorCamPic.visible = true;
        notesPic.visible = true;
        homePic.visible = true;
    }
    else {
        weatPic.visible = false;
        calenderPic.visible = false;
        doorCamPic.visible = false;
        notesPic.visible = false;
        homePic.visible = false;
        apps[0].create = false;
        apps[1].create = false;
        apps[2].create = false;
        apps[3].create = false;
        apps[4].create = false;
        apps[5].create = false;
    }
}
function closeApp(name){
    console.log("closeApp");
    if(name=="doorCam")
        updateCamApp(false,3);
    else if(name=="weather")
        updateWeatApp(false,3);
    else if(name=="notes")
        updateNoteApp(false,0);
    else if(name="calendar")
      closeHomeCal();
    else if(name="home")
      closeHomeCal();
}
function createMessage(){
    console.log("here");
    messageBody.icon = noteBoxPic.clone(function(c){
        canvas.add(c.set({left:appPic.left*16,top:appPic.top-500,visible:true})).setActiveObject(c);
        messageBodyPic = canvas.getActiveObject();

        closeIcon = new fabric.Image.fromURL('resources/close.png', function(img) {
                    img.set({left:messageBodyPic.left+400, top:messageBodyPic.top, width: charmAppHW-100,height: charmAppHW-100,
                        originX: 'left', originY: 'top', visible:true,lockMovementX:true,lockMovementY:true
                    });
                    canvas.add(img).setActiveObject(img);
                    closePic = canvas.getActiveObject();
                    closePic.on('selected',function(){
                        canvas.remove(msgHead);
                        canvas.remove(msgBody);
                        canvas.remove(closePic);
                        canvas.remove(messageBodyPic);


                        if(groupMsg.length>1) {
                            groupMsg.pop();
                            createMessage();
                        }

                        canvas.deactivateAll();
                    })
                }
        );

        msgHead = new fabric.Text(groupMsg[groupMsg.length-1].header, {left:messageBodyPic.left+50,top:messageBodyPic.top+30,fontFamily: 'Arial',fill:'black', fontSize: 40, fontWeight: 'italic', originX: 'left',
            originY: 'top',visible:true,selectable:false,evented:false,lockMovementX:false, lockMovementY:false});
        canvas.add(msgHead);

        msgBody = new fabric.Text(groupMsg[groupMsg.length-1].msg, {left:messageBodyPic.left+50,top:messageBodyPic.top+80,fontFamily: 'Arial',fill:'black', fontSize: 34, fontWeight: 'italic', originX: 'left',
            originY: 'top',visible:true,selectable:false,evented:false,lockMovementX:false, lockMovementY:false});
        canvas.add(msgBody);


        messageBodyPic.on('moving',function(){
            closePic.top = messageBodyPic.top;
            closePic.left = messageBodyPic.left+400;
            closeIcon.top = closePic.top;
            closeIcon.left = closePic.left;
            closePic.setCoords();

            msgHead.top = messageBodyPic.top+30;
            msgHead.left = messageBodyPic.left+50;

            msgBody.top = messageBodyPic.top+80;
            msgBody.left = messageBodyPic.left+50;
            canvas.deactivateAll();
        });
        messageBody.active=true;
    })

}

function createVideoMessage(){
    console.log("here");
    videoBody.icon1 = recNotePic.clone(function(c){
        canvas.add(c.set({left:appPic.left,top:appPic.top,visible:true})).setActiveObject(c);
        videoBody.videobody = canvas.getActiveObject();

        videoBody.icon5 = recBarPic.clone(function(c){
                    canvas.add(c.set({left:videoBody.videobody.left,top:videoBody.videobody.top+500,visible:true,
                        lockMovementX:true,lockMovementY:true})).setActiveObject(c);
                    videoBody.videoBar= canvas.getActiveObject();
                    videoBody.icon4 = new fabric.Image.fromURL('resources/close.png', function(img) {
                                img.set({left:videoBody.videobody.left+250, top:videoBody.videobody.top+470, width: charmAppHW-50,
                                    height:charmAppHW-50, originX: 'left', originY: 'top', visible:true,lockMovementX:true,lockMovementY:true
                                });
                                canvas.add(img).setActiveObject(img);
                                videoBody.closePic = canvas.getActiveObject();
                                videoBody.closePic.on('selected',function(){
                                    canvas.remove(videoBody.playPic);
                                    canvas.remove(videoBody.pausePic);
                                    canvas.remove(videoBody.videoBar);
                                    canvas.remove(videoBody.closePic);
                                    canvas.remove(videoBody.videobody);
                                    canvas.deactivateAll();
                                })
                            }
                    );


                    videoBody.icon3 = new fabric.Image.fromURL('resources/play.png', function(img) {
                                img.set({left:videoBody.videobody.left, top:videoBody.videobody.top+470, width: charmAppHW-50,
                                    height:charmAppHW-50, originX: 'left', originY: 'top', visible:true,lockMovementX:true,lockMovementY:true
                                });
                                canvas.add(img).setActiveObject(img);
                                videoBody.playPic = canvas.getActiveObject();
                                videoBody.playPic.on('selected',function(){
                                    console.log("here1");
                                    videoBody.playPic.visible=false;
                                    videoBody.pausePic.visible=true;
                                    canvas.deactivateAll();
                                })
                            }
                    );


                    videoBody.icon2 = new fabric.Image.fromURL('resources/pause.png', function(img) {
                                img.set({left:videoBody.videobody.left, top:videoBody.videobody.top+470, width: charmAppHW-50,
                                    height:charmAppHW-50, originX: 'left', originY: 'top', visible:false,lockMovementX:true,lockMovementY:true
                                });
                                canvas.add(img).setActiveObject(img);
                                videoBody.pausePic = canvas.getActiveObject();
                                videoBody.pausePic.on('selected',function(){
                                    videoBody.pausePic.visible=false;
                                    videoBody.playPic.visible = true;
                                    canvas.deactivateAll();
                                })
                            }
                    );
                }
        );

        videoBody.videobody.on('moving',function(){
            videoBody.videoBar.top  = videoBody.videobody.top+500;
            videoBody.videoBar.left = videoBody.videobody.left;
            /*videoBody.icon5.top     =  videoBody.videoBar.top;
             videoBody.icon5.left    = videoBody.videoBar.left;*/
            videoBody.videoBar.setCoords();
            videoBody.closePic.top = videoBody.videobody.top+470;
            videoBody.closePic.left = videoBody.videobody.left+250;
            videoBody.icon4.top =  videoBody.closePic.top;
            videoBody.icon4.left = videoBody.closePic.left;
            videoBody.closePic.setCoords();

            videoBody.playPic.top = videoBody.videobody.top+470;
            videoBody.playPic.left = videoBody.videobody.left;
            videoBody.icon3.top = videoBody.playPic.top;
            videoBody.icon3.left = videoBody.playPic.left;
            videoBody.playPic.setCoords();

            videoBody.pausePic.top = videoBody.videobody.top+470;
            videoBody.pausePic.left = videoBody.videobody.left;
            videoBody.icon2.top = videoBody.pausePic.top;
            videoBody.icon2.left = videoBody.pausePic.left;
            videoBody.pausePic.setCoords();


            canvas.deactivateAll();
        });
    })

}
//---------------------------Ryan's Code End



//#mikecode #mike
function activeIconE(emergency){
     emergency.create = true;
     if(emergency.icon ==  'emergency')
       createEmergencyIcon(emergency);
     canvas.deactivateAll();
 }

 function createEmergency(){
    createAlarm(emergency[0][0]);
    createHelp(emergency[1][0]);
    createAlerts(emergency[2][0]);
    createPass(emergency[3][0]);
    createBBack(emergency[4][0]);
    createAlertWidget(doAlerts);
    createAlarmWidget(armAlarm);
}

createEmergency();

document.onkeydown = function(evt) {
    evt = evt || window.event;
    if (evt.ctrlKey && evt.keyCode == 82) {
        //alert("Ctrl-R ya weirdo");
        console.log(userType);
        if(userType == 0){
          userType = 1;          
        }else{
          userType = 0;
        }
    }
};

 function createAlarm(icon) {

    iconPath = icon.fp;
    console.log(iconPath);

    alarmIcon = new fabric.Image.fromURL(iconPath +'.png', function(img) {

                img.set({
                    left: emergencyPic.left *3 /*topLeftInsideDoor+(doorWidth/4)*/,
                    top: emergencyPic.top *1 - 200/*(quarterDoorHeight * 1.5) + charmOffsetY*/,
                    width: charmAppHW,
                    height: charmAppHW,
                    originX: 'left',
                    originY: 'top',
                    visible: false
                });
                //icon.create = true;

                canvas.add(img).setActiveObject(img);
                alarmPic = canvas.getActiveObject();


                alarmPic.on('selected',function(){
                    console.log("setting alarm");
                    //updateEmergency(false);
                    //updateCamApp(true,4);
                    emergency[0][0].active = true;
                    emergencyIdx = 0;

                    canvas.remove(alarmWPic);
                    if(armAlarm == 0){
                      armAlarm = 1;
                    }else{
                      armAlarm = 0
                    }
                    createAlarmWidget(armAlarm);

                    canvas.deactivateAll();

                })

                alarmPic.lockMovementX = true;
                alarmPic.lockMovementY = true;}
    );

}

function createHelp(icon) {

    iconPath = icon.fp;
    console.log(iconPath);

    helpIcon = new fabric.Image.fromURL(iconPath +'.png', function(img) {

                img.set({
                    left: emergencyPic.left * 5,
                    top: emergencyPic.top *1 - 200,
                    width: charmAppHW,
                    height: charmAppHW,
                    originX: 'left',
                    originY: 'top',
                    visible: false
                });

                canvas.add(img).setActiveObject(img);
                helpPic = canvas.getActiveObject();


                helpPic.on('selected',function(){
                    console.log("calling 911");
                    //updateEmergency(false);
                    //updateCamApp(true,4);
                    emergency[1][0].active = true;
                    emergencyIdx = 1;
                    canvas.deactivateAll();

                })

                helpPic.lockMovementX = true;
                helpPic.lockMovementY = true;}
    );

}

function createAlerts(icon) {

    iconPath = icon.fp;
    console.log(iconPath);

    alertsIcon = new fabric.Image.fromURL(iconPath +'.png', function(img) {

                img.set({
                    left: emergencyPic.left * 3,
                    top: emergencyPic.top *1,
                    width: charmAppHW,
                    height: charmAppHW,
                    originX: 'left',
                    originY: 'top',
                    visible: false
                });

                canvas.add(img).setActiveObject(img);
                alertsPic = canvas.getActiveObject();


                alertsPic.on('selected',function(){
                    console.log("turning on alerts");
                    //updateEmergency(false);
                    //updateCamApp(true,4);
                    //emergency[2][0].active = true;
                    //emergencyIdx = 2;

                    canvas.remove(alertWPic);
                    if(doAlerts == 0){
                      doAlerts = 1;
                    }else{
                      doAlerts = 0
                    }
                    createAlertWidget(doAlerts);


                    canvas.deactivateAll();
                })

                alertsPic.lockMovementX = true;
                alertsPic.lockMovementY = true;}
    );

}

function createPass(icon) {

    iconPath = icon.fp;
    console.log(iconPath);

    passIcon = new fabric.Image.fromURL(iconPath +'.png', function(img) {

                img.set({
                    left: emergencyPic.left * 5,
                    top: emergencyPic.top *1 ,
                    width: charmAppHW,
                    height: charmAppHW,
                    originX: 'left',
                    originY: 'top',
                    visible: false
                });

                canvas.add(img).setActiveObject(img);
                passPic = canvas.getActiveObject();


                passPic.on('selected',function(){
                    console.log("setting temp password");
                    //updateEmergency(false);
                    //updateCamApp(true,4);
                    emergency[3][0].active = true;
                    emergencyIdx = 3;
                    canvas.deactivateAll();

                })

                passPic.lockMovementX = true;
                passPic.lockMovementY = true;}
    );

}


 function createBBack(icon) {

    iconPath = icon.fp;
    console.log(iconPath);

    backBIcon = new fabric.Image.fromURL(iconPath +'.png', function(img) {

                img.set({
                    left: emergencyPic.left * 7 /*topLeftInsideDoor+(doorWidth/4)*/,
                    top: emergencyPic.top *1 /*(quarterDoorHeight * 1.5) + charmOffsetY*/,
                    width: charmAppHW,
                    height: charmAppHW,
                    originX: 'left',
                    originY: 'top',
                    visible: false
                });
                //icon.create = true;

                canvas.add(img).setActiveObject(img);
                backBPic = canvas.getActiveObject();


                backBPic.on('selected',function(){
                    console.log("going back");
                    updateEmergency(false);

                    activeIconE(charmBar[0]);
                    //updateCamApp(true,4);
                    emergency[4][0].active = true;
                    emergencyIdx = 4;

                    canvas.deactivateAll();

                })

                backBPic.lockMovementX = true;
                backBPic.lockMovementY = true;}
    );

}

function createAlertWidget(state) {

    //iconPath = icon.fp;
    //console.log(iconPath);
    //
    alertWIcon = new fabric.Image.fromURL('resources/alertsOn.png', function(img) {

              if(state == 1){
                img.set({
                    left: insideKnobStartX,
                    top: 300,
                    width: charmAppHWs * .8,
                    height: charmAppHWs * .8,
                    originX: 'left',
                    originY: 'top',
                    visible: true
                });
                }else{
                  img.set({
                    left: insideKnobStartX,
                    top: 300,
                    width: charmAppHWs * .8,
                    height: charmAppHWs * .8,
                    originX: 'left',
                    originY: 'top',
                    visible: false
                });
                }

                canvas.add(img).setActiveObject(img);
                alertWPic = canvas.getActiveObject();
                

                alertWPic.on('selected',function(){
                    console.log("alertwidget");
                    //updateEmergency(false);
                    //updateCamApp(true,4);
                    //emergency[3][0].active = true;
                    //emergencyIdx = 3;
                    //canvas.deactivateAll();

                })

                alertWPic.lockMovementX = true;
                alertWPic.lockMovementY = true;}
    );

}

function createAlarmWidget(state) {

    //iconPath = icon.fp;
    //console.log(iconPath);
    alarmWIcon = new fabric.Image.fromURL('resources/alarmActive.png', function(img) {

              if(state == 1){
                img.set({
                    left: insideKnobStartX- 85,
                    top: 300,
                    width: charmAppHWs * .8,
                    height: charmAppHWs * .8,
                    originX: 'left',
                    originY: 'top',
                    visible: true
                });
              }else{
                img.set({
                    left: insideKnobStartX- 85,
                    top: 300,
                    width: charmAppHWs * .8,
                    height: charmAppHWs * .8,
                    originX: 'left',
                    originY: 'top',
                    visible: false
                });
              }
                canvas.add(img).setActiveObject(img);
                alarmWPic = canvas.getActiveObject();
                
                 


                alarmWPic.on('selected',function(){
                    console.log("armingalarm");
                    //updateEmergency(false);
                    //updateCamApp(true,4);
                    //emergency[3][0].active = true;
                    //emergencyIdx = 3;
                    //canvas.deactivateAll();

                })

                alarmWPic.lockMovementX = true;
                alarmWPic.lockMovementY = true;}
    );

}



 function updateEmergency(isVisible){

    if(isVisible==true) {
        alarmPic.visible = true;
        helpPic.visible = true;
        alertsPic.visible = true;
        passPic.visible = true;
        backBPic.visible = true;
    }
    else {
        alarmPic.visible = false;
        helpPic.visible = false;
        alertsPic.visible = false;
        passPic.visible = false;
        backBPic.visible = false;

        emergency[0].create = false;
        emergency[1].create = false;
        emergency[2].create = false;
        emergency[3].create = false;
        emergency[4].create = false;
    }
}

function updateEmergencyPos(){
    alarmPic.top = emergencyPic.top - 200;
    canvas.remove(alarmPic);
    canvas.add(alarmPic);
    helpPic.top = emergencyPic.top - 200;
    canvas.remove(helpPic);
    canvas.add(helpPic);
    alertsPic.top = emergencyPic.top;
    canvas.remove(alertsPic);
    canvas.add(alertsPic);
    passPic.top = emergencyPic.top;
    canvas.remove(passPic);
    canvas.add(passPic);
    


}

function closeEmergency(name){
    /*if(name=="doorCam")
        updateCamApp(false,3);
    else if(name=="weather")
        updateWeatApp(false,3)*/

}

//#doorcode
function createDoors(){
    createKey(outsideKnob[0][0]);    
    createPostIt(outsideKnob[1][0]);
    createBell(outsideKnob[2][0]);
    createInsideImg(doorState);
    //createInsideImg(insideKnob[1][0]);
    //createInsideImg(insideKnob[2][0]);
    //createInsideImg(insideKnob[3][0]);
    createLockButton(insideKnob[4][0]);
    createOpenButton(insideKnob[5][0]);

}

createDoors();

function createKey(icon) {

    iconPath = icon.fp;
    console.log(iconPath);

    keyIcon = new fabric.Image.fromURL(iconPath +'.png', function(img) {

                img.set({
                    left: outsideKnobStartX - 75,
                    top: doorKnobStartY - 250,
                    width: charmAppHWs,
                    height: charmAppHWs,
                    originX: 'left',
                    originY: 'top',
                    visible: true
                });

                canvas.add(img).setActiveObject(img);
                keyPic = canvas.getActiveObject();


                keyPic.on('selected',function(){
                    console.log("tryna open the door");
                    if(userType == 0){//registered user
                      if(doorState == 0){//door open and unlocked

                      }else if(doorState == 1){

                      }
                    }else if(doAlerts == 1){
                      if(userType == 1){
                        //do something spooky! serious show someone's face or something
                      }
                    }

                })

                keyPic.lockMovementX = true;
                keyPic.lockMovementY = true;}
    );

}

function createPostIt(icon) {

    iconPath = icon.fp;
    console.log(iconPath);

    postItIcon3 = new fabric.Image.fromURL(iconPath +'.png', function(img) {

                img.set({
                    left: outsideKnobStartX - 75,
                    top: doorKnobStartY + 85,
                    width: charmAppHWs,
                    height: charmAppHWs,
                    originX: 'left',
                    originY: 'top',
                    visible: true
                });

                canvas.add(img).setActiveObject(img);
                postItPic3 = canvas.getActiveObject();


                postItPic3.on('selected',function(){
                    console.log("tryna leave a message");
                    /*updateEmergency(false);
                    emergency[3][0].active = true;
                    emergencyIdx = 3;
                    canvas.deactivateAll();*/

                })

                postItPic3.lockMovementX = true;
                postItPic3.lockMovementY = true;}
    );

}

function createBell(icon) {

    iconPath = icon.fp;
    console.log(iconPath);

    bellIcon = new fabric.Image.fromURL(iconPath +'.png', function(img) {

                img.set({
                    left: outsideKnobStartX + 100,
                    top: doorKnobStartY - 75,
                    width: charmAppHWs,
                    height: charmAppHWs,
                    originX: 'left',
                    originY: 'top',
                    visible: true
                });

                canvas.add(img).setActiveObject(img);
                bellPic = canvas.getActiveObject();


                bellPic.on('selected',function(){
                    console.log("tryna ring the doorbell");
                    /*updateEmergency(false);
                    emergency[3][0].active = true;
                    emergencyIdx = 3;
                    canvas.deactivateAll();*/

                })

                bellPic.lockMovementX = true;
                bellPic.lockMovementY = true;}
    );

}

function createInsideImg(state){  
      iconPath = insideKnob[state][0].fp;
      console.log(iconPath);

      doorStateIcon = new fabric.Image.fromURL(iconPath +'.png', function(img) {

                img.set({
                    left: insideKnobStartX - 100,
                    top: doorKnobStartY - 260,
                    width: 200,
                    height: 500,
                    originX: 'left',
                    originY: 'top',
                    visible: true,
                    
                });

                canvas.add(img).setActiveObject(img);
                doorStatePic = canvas.getActiveObject();
                doorStatePic.sendBackwards(true);


                doorStatePic.on('selected',function(){
                    console.log("testing123");
                    /*updateEmergency(false);
                    emergency[3][0].active = true;
                    emergencyIdx = 3;
                    canvas.deactivateAll();*/

                })

                doorStatePic.lockMovementX = true;
                doorStatePic.lockMovementY = true;}
    );
}

function createLockButton(icon){
  iconPath = icon.fp;
      console.log(iconPath);

     lockIcon = new fabric.Image.fromURL(iconPath +'.png', function(img) {

                img.set({
                    left: insideKnobStartX - 75,
                    top: doorKnobStartY + 125,
                    width: charmAppHWs,
                    height: charmAppHWs + 25,
                    originX: 'left',
                    originY: 'top',
                    visible: true,
                    
                });

                canvas.add(img).setActiveObject(img);
                lockPic = canvas.getActiveObject();


                lockPic.on('selected',function(){
                    console.log("toggling doorlock" +  " doorstate:" + doorState);
                    if(doorState == 0){//
                      doorState = 1;
                    } else
                    if(doorState == 2){
                      doorState = 3;
                    } else
                    if(doorState == 1){
                      doorState = 0;
                    } else
                    if(doorState == 3){
                      doorState = 2;
                    }
                    createInsideImg(doorState);
                    createLockButton(insideKnob[4][0]);
                    createOpenButton(insideKnob[5][0]);
                })

                lockPic.lockMovementX = true;
                lockPic.lockMovementY = true;}
    );
}

function createOpenButton(icon){
      iconPath = icon.fp;
      console.log(iconPath);

     openerIcon = new fabric.Image.fromURL(iconPath +'.png', function(img) {

                img.set({
                    left: insideKnobStartX - 75,
                    top: doorKnobStartY - 290,
                    width: charmAppHWs,
                    height: charmAppHWs + 25,
                    originX: 'left',
                    originY: 'top',
                    visible: true,
                    
                });

                canvas.add(img).setActiveObject(img);
                openerPic = canvas.getActiveObject();


                openerPic.on('selected',function(){
                    console.log("toggling dooropener" +  " doorstate:" + doorState);
                    if(doorState == 0){
                      doorState = 2;
                    } else
                    if(doorState == 1){
                      doorState = 3;
                    } else
                    if(doorState == 2){
                      doorState = 0;
                    } else
                    if(doorState == 3){
                      doorState = 1;
                    }
                    createInsideImg(doorState);
                    createLockButton(insideKnob[4][0]);
                    createOpenButton(insideKnob[5][0]);

                })

                openerPic.lockMovementX = true;
                openerPic.lockMovementY = true;}
    );
}

//</mikecode>


//---------------------------Matts Code Start
//**********Sections in Ryans code were I made changes are marked between comments like this**********//
//Change Starts////////////////////////////////////////
//Code
//Change Ends////////////////////////////////////////
//so just ctrl+f and type Change starts to find changes
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////
//Start of adding items to canvas//////
function createAppIcons2() {
    homeIcon2 = new fabric.Image.fromURL('resources/home2.png', function (img) {
        img.set({
            left: appPic.left * 7 - 225,
            top: appPic.top * 1 - 500,
            width: charmAppHW - 30,
            height: charmAppHW - 30,
            originX: 'left',
            originY: 'top',
            visible: false
        });
        canvas.add(img).setActiveObject(img);
        ;
        homePic2 = canvas.getActiveObject(img);
        homePic2.on('selected', function () {

            canvas.deactivateAll();
        })
        homePic2.lockMovementY = true;
        homePic2.lockMovementX = true;
    });
    lighticon = new fabric.Image.fromURL('resources/light.png', function (img) {
        img.set({
            left: appPic.left * 7 - 25,
            top: appPic.top * 1,
            width: charmAppHW - 30,
            height: charmAppHW - 30,
            originX: 'left',
            originY: 'top',
            visible: false
        });
        canvas.add(img).setActiveObject(img);
        ;
        lightpic = canvas.getActiveObject(img);
        lightpic.on('selected', function () {
            homeMenu(7);
            canvas.deactivateAll();
        })
        lightpic.lockMovementY = true;
        lightpic.lockMovementX = true;
    });
    lighticon2 = new fabric.Image.fromURL('resources/light2.png', function (img) {
        img.set({
            left: appPic.left * 7 - 225,
            top: appPic.top * 1 - 500,
            width: charmAppHW - 30,
            height: charmAppHW - 30,
            originX: 'left',
            originY: 'top',
            visible: false
        });
        canvas.add(img).setActiveObject(img);
        ;
        lightpic2 = canvas.getActiveObject(img);
        lightpic2.on('selected', function () {

            canvas.deactivateAll();
        })
        lightpic2.lockMovementY = true;
        lightpic2.lockMovementX = true;
    });
    homeLockIcon = new fabric.Image.fromURL('resources/homeLock.png', function (img) {
        img.set({
            left: appPic.left * 7 - 225,
            top: appPic.top * 1,
            width: charmAppHW - 30,
            height: charmAppHW - 30,
            originX: 'left',
            originY: 'top',
            visible: false
        });
        canvas.add(img).setActiveObject(img);
        ;
        homeLockPic = canvas.getActiveObject(img);
        homeLockPic.on('selected', function () {
            homeMenu(5);
            canvas.deactivateAll();
        })
        homeLockPic.lockMovementY = true;
        homeLockPic.lockMovementX = true;
    });
    homeLockIcon2 = new fabric.Image.fromURL('resources/homeLock2.png', function (img) {
        img.set({
            left: appPic.left * 7 - 225,
            top: appPic.top * 1 - 500,
            width: charmAppHW - 30,
            height: charmAppHW - 30,
            originX: 'left',
            originY: 'top',
            visible: false
        });
        canvas.add(img).setActiveObject(img);
        ;
        homeLockPic2 = canvas.getActiveObject(img);
        homeLockPic2.on('selected', function () {

            canvas.deactivateAll();
        })
        homeLockPic2.lockMovementY = true;
        homeLockPic2.lockMovementX = true;
    });
    thermIcon = new fabric.Image.fromURL('resources/therm.png', function (img) {
        img.set({
            left: appPic.left * 7 - 425,
            top: appPic.top * 1,
            width: charmAppHW - 30,
            height: charmAppHW - 30,
            originX: 'left',
            originY: 'top',
            visible: false
        });
        canvas.add(img).setActiveObject(img);
        ;
        thermPic = canvas.getActiveObject(img);
        thermPic.on('selected', function () {
            homeMenu(3);
            canvas.deactivateAll();
        })
        thermPic.lockMovementY = true;
        thermPic.lockMovementX = true;
    });
    thermIcon2 = new fabric.Image.fromURL('resources/therm2.png', function (img) {
        img.set({
            left: appPic.left * 7 - 225,
            top: appPic.top * 1 - 500,
            width: charmAppHW - 30,
            height: charmAppHW - 30,
            originX: 'left',
            originY: 'top',
            visible: false
        });
        canvas.add(img).setActiveObject(img);
        ;
        thermPic2 = canvas.getActiveObject(img);
        thermPic2.on('selected', function () {

            canvas.deactivateAll();
        })
        thermPic2.lockMovementY = true;
        thermPic2.lockMovementX = true;
    });
    tempAdj = new fabric.Image.fromURL('resources/tmpAdj.png', function (img) {
        img.set({
            left: appPic.left * 7 + 100,
            top: appPic.top * 1 + 300,
            width: charmAppHW - 800,
            height: charmAppHW - 800,
            originX: 'left',
            originY: 'top',
            visible: false
        });
        canvas.add(img).setActiveObject(img);
        ;
        tempAdjPic = canvas.getActiveObject(img);
        tempAdjPic.on('selected', function () {

            canvas.deactivateAll();
        })
        tempAdjPic.lockMovementY = true;
        tempAdjPic.lockMovementX = true;
    });
    homeBack = new fabric.Image.fromURL('resources/back.png', function (img) {
        img.set({
            left: appPic.left * 7 - 225,
            top: appPic.top * 1 + 200,
            width: charmAppHW - 30,
            height: charmAppHW - 30,
            originX: 'left',
            originY: 'top',
            visible: false
        });
        canvas.add(img).setActiveObject(img);
        ;
        homeBackPic = canvas.getActiveObject(img);
        homeBackPic.on('selected', function () {
            homeMenu(2);
            canvas.deactivateAll();
        })
        homeBackPic.lockMovementY = true;
        homeBackPic.lockMovementX = true;
    });
    tempBack = new fabric.Image.fromURL('resources/back.png', function (img) {
        img.set({
            left: appPic.left * 7 - 225,
            top: appPic.top * 1 + 300,
            width: charmAppHW - 30,
            height: charmAppHW - 30,
            originX: 'left',
            originY: 'top',
            visible: false
        });
        canvas.add(img).setActiveObject(img);
        ;
        tempBackPic = canvas.getActiveObject(img);
        tempBackPic.on('selected', function () {
            homeMenu(4);
            canvas.deactivateAll();
        })
        tempBackPic.lockMovementY = true;
        tempBackPic.lockMovementX = true;
    });
    lockBack = new fabric.Image.fromURL('resources/back.png', function (img) {
        img.set({
            left: appPic.left * 7 - 225,
            top: appPic.top * 1 + 450,
            width: charmAppHW - 30,
            height: charmAppHW - 30,
            originX: 'left',
            originY: 'top',
            visible: false
        });
        canvas.add(img).setActiveObject(img);
        ;
        lockBackPic = canvas.getActiveObject(img);
        lockBackPic.on('selected', function () {
            homeMenu(6);
            canvas.deactivateAll();
        })
        lockBackPic.lockMovementY = true;
        lockBackPic.lockMovementX = true;
    });
    lockBack = new fabric.Image.fromURL('resources/back.png', function (img) {
        img.set({
            left: appPic.left * 7 - 225,
            top: appPic.top * 1 + 450,
            width: charmAppHW - 30,
            height: charmAppHW - 30,
            originX: 'left',
            originY: 'top',
            visible: false
        });
        canvas.add(img).setActiveObject(img);
        ;
        lockBackPic = canvas.getActiveObject(img);
        lockBackPic.on('selected', function () {
            homeMenu(6);
            canvas.deactivateAll();
        })
        lockBackPic.lockMovementY = true;
        lockBackPic.lockMovementX = true;
    });
    lightBack = new fabric.Image.fromURL('resources/back.png', function (img) {
        img.set({
            left: appPic.left * 7 - 225,
            top: appPic.top * 1 + 550,
            width: charmAppHW - 30,
            height: charmAppHW - 30,
            originX: 'left',
            originY: 'top',
            visible: false
        });
        canvas.add(img).setActiveObject(img);
        ;
        lightBackPic = canvas.getActiveObject(img);
        lightBackPic.on('selected', function () {
            homeMenu(8);
            canvas.deactivateAll();
        })
        lightBackPic.lockMovementY = true;
        lightBackPic.lockMovementX = true;
    });
    //Lock page images Start///////////////////////////////////////////////////////////////////////////////////////////////////////////
    ///////////////////////start unlock icons/////////////////////////////////////////////////////
    homedoorIcon = new fabric.Image.fromURL('resources/homeDoors.png', function (img) {
        img.set({
            left: appPic.left * 7 + 25,
            top: appPic.top * 1 + 400,
            width: charmAppHW - 700,
            height: charmAppHW - 850,
            originX: 'left',
            originY: 'top',
            visible: false
        });
        canvas.add(img).setActiveObject(img);
        ;
        homeDoorPic = canvas.getActiveObject(img);
        homeDoorPic.on('selected', function () {
            canvas.deactivateAll();
        })
        homeDoorPic.lockMovementY = true;
        homeDoorPic.lockMovementX = true;
    });
    unlockIcon1 = new fabric.Image.fromURL('resources/homeUnlock.png', function (img) {
        img.set({
            left: appPic.left * 7 + 25,
            top: appPic.top * 1 - 200,
            width: charmAppHW - 70,
            height: charmAppHW - 70,
            originX: 'left',
            originY: 'top',
            visible: false
        });
        canvas.add(img).setActiveObject(img);
        ;
        unlockPic1 = canvas.getActiveObject(img);
        unlockPic1.on('selected', function () {
            houseLocks(1, 0);
            canvas.deactivateAll();
        })
        unlockPic1.lockMovementY = true;
        unlockPic1.lockMovementX = true;
    });
    unlockIcon2 = new fabric.Image.fromURL('resources/homeUnlock.png', function (img) {
        img.set({
            left: appPic.left * 7 + 25,
            top: appPic.top * 1 - 50,
            width: charmAppHW - 70,
            height: charmAppHW - 70,
            originX: 'left',
            originY: 'top',
            visible: false
        });
        canvas.add(img).setActiveObject(img);
        ;
        unlockPic2 = canvas.getActiveObject(img);
        unlockPic2.on('selected', function () {
            houseLocks(2, 0);
            canvas.deactivateAll();
        })
        unlockPic2.lockMovementY = true;
        unlockPic2.lockMovementX = true;
    });
    unlockIcon3 = new fabric.Image.fromURL('resources/homeUnlock.png', function (img) {
        img.set({
            left: appPic.left * 7 + 25,
            top: appPic.top * 1 + 100,
            width: charmAppHW - 70,
            height: charmAppHW - 70,
            originX: 'left',
            originY: 'top',
            visible: false
        });
        canvas.add(img).setActiveObject(img);
        ;
        unlockPic3 = canvas.getActiveObject(img);
        unlockPic3.on('selected', function () {
            houseLocks(3, 0);
            canvas.deactivateAll();
        })
        unlockPic3.lockMovementY = true;
        unlockPic3.lockMovementX = true;
    });
    unlockIcon4 = new fabric.Image.fromURL('resources/homeUnlock.png', function (img) {
        img.set({
            left: appPic.left * 7 + 25,
            top: appPic.top * 1 + 250,
            width: charmAppHW - 70,
            height: charmAppHW - 70,
            originX: 'left',
            originY: 'top',
            visible: false
        });
        canvas.add(img).setActiveObject(img);
        ;
        unlockPic4 = canvas.getActiveObject(img);
        unlockPic4.on('selected', function () {
            houseLocks(4, 0);
            canvas.deactivateAll();
        })
        unlockPic4.lockMovementY = true;
        unlockPic4.lockMovementX = true;
    });
}
    //////////////////////End unlock Icons////////////////////////////////////////////////////////////////////////////////
//////////////////////Start lock Icons//////////////////////////////////////////////////////////////////////////////////////////
function createdoorlock() {
    lockIcon1 = new fabric.Image.fromURL('resources/homeLocked.png', function (img) {
        img.set({
            left: appPic.left * 7 + 25,
            top: appPic.top * 1 - 200,
            width: charmAppHW - 70,
            height: charmAppHW - 70,
            originX: 'left',
            originY: 'top',
            visible: false
        });
        canvas.add(img).setActiveObject(img);
        ;
        lockPic1 = canvas.getActiveObject(img);
        lockPic1.on('selected', function () {
            houseLocks(1, 1);
            canvas.deactivateAll();
        })
        lockPic1.lockMovementY = true;
        lockPic1.lockMovementX = true;
    });
    lockIcon2 = new fabric.Image.fromURL('resources/homeLocked.png', function (img) {
        img.set({
            left: appPic.left * 7 + 25,
            top: appPic.top * 1 - 50,
            width: charmAppHW - 70,
            height: charmAppHW - 70,
            originX: 'left',
            originY: 'top',
            visible: false
        });
        canvas.add(img).setActiveObject(img);
        ;
        lockPic2 = canvas.getActiveObject(img);
        lockPic2.on('selected', function () {
            houseLocks(2, 1);
            canvas.deactivateAll();
        })
        lockPic2.lockMovementY = true;
        lockPic2.lockMovementX = true;
    });
    lockIcon3 = new fabric.Image.fromURL('resources/homeLocked.png', function (img) {
        img.set({
            left: appPic.left * 7 + 25,
            top: appPic.top * 1 + 100,
            width: charmAppHW - 70,
            height: charmAppHW - 70,
            originX: 'left',
            originY: 'top',
            visible: false
        });
        canvas.add(img).setActiveObject(img);
        ;
        lockPic3 = canvas.getActiveObject(img);
        lockPic3.on('selected', function () {
            houseLocks(3, 1);
            canvas.deactivateAll();
        })
        lockPic3.lockMovementY = true;
        lockPic3.lockMovementX = true;
    });
    lockIcon4 = new fabric.Image.fromURL('resources/homeLocked.png', function (img) {
        img.set({
            left: appPic.left * 7 + 25,
            top: appPic.top * 1 + 250,
            width: charmAppHW - 70,
            height: charmAppHW - 70,
            originX: 'left',
            originY: 'top',
            visible: false
        });
        canvas.add(img).setActiveObject(img);
        ;
        lockPic4 = canvas.getActiveObject(img);
        lockPic4.on('selected', function () {
            houseLocks(4, 1);
            canvas.deactivateAll();
        })
        lockPic4.lockMovementY = true;
        lockPic4.lockMovementX = true;
    });
}
//////////////////////////////////End Lock icons////////////////////////////////////////////////////////////////////////////////////////////
var lockArr = [5];
//Lock unlock function
function houseLocks(menuID,state){
  if(menuID == 1){
    if(state == 0){
      unlockPic1.visible = false;
      lockPic1.visible = true;
      lockArr[0]=1;
    }
    else{
      lockPic1.visible=false;
      unlockPic1.visible=true;
       lockArr[0]=0;
    }
  }
  else if(menuID == 2){
       if(state == 0){
      unlockPic2.visible = false;
      lockPic2.visible = true;
       lockArr[1]=1;
    }
    else{
      lockPic2.visible=false;
      unlockPic2.visible=true;
       lockArr[1]=0;
    }
  }
  else if(menuID == 3){
       if(state == 0){
      unlockPic3.visible = false;
      lockPic3.visible = true;
       lockArr[2]=1;
    }
    else{
      lockPic3.visible=false;
      unlockPic3.visible=true;
       lockArr[2]=0;
    }
  }
  else if(menuID == 4){
       if(state == 0){
      unlockPic4.visible = false;
      lockPic4.visible = true;
       lockArr[3]=1;
    }
    else{
      lockPic4.visible=false;
      unlockPic4.visible=true;
       lockArr[3]=0;
    }
  }
}
 //Lock page images End///////////////////////////////////////////////////////////////////////////////////////////////////////////
 //Light page images Start///////////////////////////////////////////////////////////////////////////////////////////////////////////
  homeLightIcon = new fabric.Image.fromURL('resources/lightRooms.png',function(img) { 
 img.set({left: appPic.left *7 + 25, top: appPic.top * 1 + 550 ,  width: charmAppHW -700, height: charmAppHW- 950, originX: 'left', originY: 'top', visible: false});
 canvas.add(img).setActiveObject(img);;
 homeLightPic = canvas.getActiveObject(img);
 homeLightPic.on('selected',function(){
  canvas.deactivateAll();
 })
 homeLightPic.lockMovementY=true;
  homeLightPic.lockMovementX=true;
});
  ///////////////////////start Light On icons/////////////////////////////////////////////////////
 lightOnIcon1 = new fabric.Image.fromURL('resources/lightOn.png',function(img) { 
 img.set({left: appPic.left *7 + 25, top: appPic.top * 1 - 200 ,  width: charmAppHW -70, height: charmAppHW- 70, originX: 'left', originY: 'top', visible: false});
 canvas.add(img).setActiveObject(img);;
 lightOnPic1 = canvas.getActiveObject(img);
 lightOnPic1.on('selected',function(){
  houseLights(1,0);
  canvas.deactivateAll();
 })
 lightOnPic1.lockMovementY=true;
  lightOnPic1.lockMovementX=true;
});
  lightOnIcon2 = new fabric.Image.fromURL('resources/lightOn.png',function(img) { 
 img.set({left: appPic.left *7 + 25, top: appPic.top * 1 - 50 ,  width: charmAppHW -70, height: charmAppHW- 70, originX: 'left', originY: 'top', visible: false});
 canvas.add(img).setActiveObject(img);;
 lightOnPic2 = canvas.getActiveObject(img);
 lightOnPic2.on('selected',function(){
  houseLights(2,0);
  canvas.deactivateAll();
 })
 lightOnPic2.lockMovementY=true;
  lightOnPic2.lockMovementX=true;
});
   lightOnIcon3 = new fabric.Image.fromURL('resources/lightOn.png',function(img) { 
 img.set({left: appPic.left *7 + 25, top: appPic.top * 1 + 100 ,  width: charmAppHW -70, height: charmAppHW- 70, originX: 'left', originY: 'top', visible: false});
 canvas.add(img).setActiveObject(img);;
 lightOnPic3 = canvas.getActiveObject(img);
 lightOnPic3.on('selected',function(){
  houseLights(3,0);
  canvas.deactivateAll();
 })
 lightOnPic3.lockMovementY=true;
  lightOnPic3.lockMovementX=true;
});
    lightOnIcon4 = new fabric.Image.fromURL('resources/lightOn.png',function(img) { 
 img.set({left: appPic.left *7 + 25, top: appPic.top * 1 + 250 ,  width: charmAppHW -70, height: charmAppHW- 70, originX: 'left', originY: 'top', visible: false});
 canvas.add(img).setActiveObject(img);;
 lightOnPic4 = canvas.getActiveObject(img);
 lightOnPic4.on('selected',function(){
  houseLights(4,0);
  canvas.deactivateAll();
 })
 lightOnPic4.lockMovementY=true;
  lightOnPic4.lockMovementX=true;
});
     lightOnIcon5 = new fabric.Image.fromURL('resources/lightOn.png',function(img) { 
 img.set({left: appPic.left *7 + 25, top: appPic.top * 1 + 400 ,  width: charmAppHW -70, height: charmAppHW- 70, originX: 'left', originY: 'top', visible: false});
 canvas.add(img).setActiveObject(img);;
 lightOnPic5 = canvas.getActiveObject(img);
 lightOnPic5.on('selected',function(){
  houseLights(5,0);
  canvas.deactivateAll();
 })
 lightOnPic5.lockMovementY=true;
  lightOnPic5.lockMovementX=true;
});
  ///////////////////////End Light On icons/////////////////////////////////////////////////////
    ///////////////////////start Light Off icons/////////////////////////////////////////////////////
      lightOffIcon1 = new fabric.Image.fromURL('resources/lightOff.png',function(img) { 
 img.set({left: appPic.left *7 + 25, top: appPic.top * 1 - 200 ,  width: charmAppHW -100, height: charmAppHW- 80, originX: 'left', originY: 'top', visible: false});
 canvas.add(img).setActiveObject(img);;
 lightOffPic1 = canvas.getActiveObject(img);
 lightOffPic1.on('selected',function(){
  houseLights(1,1);
  canvas.deactivateAll();
 })
 lightOffPic1.lockMovementY=true;
  lightOffPic1.lockMovementX=true;
});
  lightOffIcon2 = new fabric.Image.fromURL('resources/lightOff.png',function(img) { 
 img.set({left: appPic.left *7 + 25, top: appPic.top * 1 - 50 ,  width: charmAppHW -100, height: charmAppHW- 80, originX: 'left', originY: 'top', visible: false});
 canvas.add(img).setActiveObject(img);;
 lightOffPic2 = canvas.getActiveObject(img);
 lightOffPic2.on('selected',function(){
  houseLights(2,1);
  canvas.deactivateAll();
 })
 lightOffPic2.lockMovementY=true;
  lightOffPic2.lockMovementX=true;
});
   lightOffIcon3 = new fabric.Image.fromURL('resources/lightOff.png',function(img) { 
 img.set({left: appPic.left *7 + 25, top: appPic.top * 1 + 100 ,  width: charmAppHW -100, height: charmAppHW- 80, originX: 'left', originY: 'top', visible: false});
 canvas.add(img).setActiveObject(img);;
 lightOffPic3 = canvas.getActiveObject(img);
 lightOffPic3.on('selected',function(){
  houseLights(3,1);
  canvas.deactivateAll();
 })
 lightOffPic3.lockMovementY=true;
  lightOffPic3.lockMovementX=true;
});
    lightOffIcon4 = new fabric.Image.fromURL('resources/lightOff.png',function(img) { 
 img.set({left: appPic.left *7 + 25, top: appPic.top * 1 + 250 ,  width: charmAppHW -100, height: charmAppHW- 80, originX: 'left', originY: 'top', visible: false});
 canvas.add(img).setActiveObject(img);;
 lightOffPic4 = canvas.getActiveObject(img);
 lightOffPic4.on('selected',function(){
 houseLights(4,1); 
  canvas.deactivateAll();
 })
 lightOffPic4.lockMovementY=true;
  lightOffPic4.lockMovementX=true;
});
     lightOffIcon5 = new fabric.Image.fromURL('resources/lightOff.png',function(img) { 
 img.set({left: appPic.left *7 + 25, top: appPic.top * 1 + 400 ,  width: charmAppHW -100, height: charmAppHW- 80, originX: 'left', originY: 'top', visible: false});
 canvas.add(img).setActiveObject(img);;
 lightOffPic5 = canvas.getActiveObject(img);
 lightOffPic5.on('selected',function(){
  houseLights(5,1);
  canvas.deactivateAll();
 })
 lightOffPic5.lockMovementY=true;
  lightOffPic5.lockMovementX=true;
});
  ///////////////////////end Light Off icons/////////////////////////////////////////////////////
var lightArr = [5];
//Light on/off function
function houseLights(menuID,state){
  if(menuID == 1){
    if(state == 0){
      lightOnPic1.visible = false;
      lightOffPic1.visible = true;
      lightArr[0] = 1;
    }
    else{
      lightOffPic1.visible=false;
      lightOnPic1.visible=true;
      lightArr[0] = 0;
    }
  }
  else if(menuID == 2){
       if(state == 0){
      lightOnPic2.visible = false;
      lightOffPic2.visible = true;
      lightArr[1] = 1;
    }
    else{
      lightOffPic2.visible=false;
      lightOnPic2.visible=true;
       lightArr[1] = 0;
    }
  }
  else if(menuID == 3){
       if(state == 0){
      lightOnPic3.visible = false;
      lightOffPic3.visible = true;
      lightArr[2] = 1;
    }
    else{
      lightOffPic3.visible=false;
      lightOnPic3.visible=true;
       lightArr[2] = 0;
    }
  }
  else if(menuID == 4){
       if(state == 0){
      lightOnPic4.visible = false;
      lightOffPic4.visible = true;
       lightArr[3] = 1;
    }
    else{
      lightOffPic4.visible=false;
      lightOnPic4.visible=true;
       lightArr[3] = 0;
    }
  }
    else if(menuID == 5){
       if(state == 0){
      lightOnPic5.visible = false;
      lightOffPic5.visible = true;
       lightArr[4] = 1;
    }
    else{
      lightOffPic5.visible=false;
      lightOnPic5.visible=true;
       lightArr[4] = 0;
    }
  }
}
  //Light page images End///////////////////////////////////////////////////////////////////////////////////////////////////////////
//End of adding items to canvas//////
///////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//Home menu function
function homeMenu(menuOption){
  //Hit home button brining up home options
if(menuOption == 1){
homePic2.visible = true;
thermPic.visible = true;
lightpic.visible = true;
homeLockPic.visible = true;
homeBackPic.visible = true;
hideApps()
}
//Hit the home back button bringing you to the main app page
else if (menuOption ==2){
homePic2.visible = false;
thermPic.visible = false;
lightpic.visible = false;
homeLockPic.visible = false;
homeBackPic.visible = false;
  showApps()
}
//Hit the therm button bringing up house temp menu
else if (menuOption == 3){
  homePic2.visible = false;
thermPic.visible = false;
lightpic.visible = false;
homeLockPic.visible = false;
homeBackPic.visible = false;
thermPic2.visible = true;
tempAdjPic.visible = true;
tempBackPic.visible = true;
}
//Hit the back button in the therm menu to bring back to home options page
else if(menuOption == 4){
homePic2.visible = true;
thermPic.visible = true;
lightpic.visible = true;
homeLockPic.visible = true;
homeBackPic.visible = true;
thermPic2.visible = false;
tempAdjPic.visible = false;
tempBackPic.visible = false;
}
//Hit lock button to open lock menu
else if(menuOption == 5){
homePic2.visible = false;
thermPic.visible = false;
lightpic.visible = false;
homeLockPic.visible = false;
homeBackPic.visible = false;
homeLockPic2.visible = true;
homeDoorPic.visible = true;
if(lockArr[0] == 1){
  lockPic1.visible = true;
  unlockPic1.visible = false;
}
else if (lockArr[0] != 1){
unlockPic1.visible = true;
lockPic1.visible = false;
}
if(lockArr[1] == 1){
  lockPic2.visible = true;
  unlockPic2.visible = false;
}
else if (lockArr[1] != 1){
unlockPic2.visible = true;
lockPic2.visible = false;
}
if(lockArr[2] == 1){
  lockPic3.visible = true;
  unlockPic3.visible = false;
}
else if (lockArr[2] != 1){
unlockPic3.visible = true;
lockPic3.visible = false;
}
if(lockArr[3] == 1){
  lockPic4.visible = true;
  unlockPic4.visible = false;
}
else if (lockArr[4] != 1){
unlockPic4.visible = true;
lockPic4.visible = false;
}
lockBackPic.visible = true;
}
//Hit back button in lock menu goes back to home menu
else if(menuOption == 6){
homePic2.visible = true;
thermPic.visible = true;
lightpic.visible = true;
homeLockPic.visible = true;
homeBackPic.visible = true;
homeDoorPic.visible = false;
lockBackPic.visible = false;
homeLockPic2.visible = false;
unlockPic1.visible = false;
unlockPic2.visible = false;
unlockPic3.visible = false;
unlockPic4.visible = false;
lockPic1.visible = false;
lockPic2.visible = false;
lockPic3.visible = false;
lockPic4.visible = false;
}
//Hit Light Button to open light menu
else if(menuOption == 7){
homePic2.visible = false;
thermPic.visible = false;
lightpic.visible = false;
homeLockPic.visible = false;
homeBackPic.visible = false;
lightpic2.visible = true;
if(lightArr[0] == 1){
  lightOffPic1.visible = true;
  lightOnPic1.visible = false;
}
else if (lightArr[0] != 1){
lightOnPic1.visible = true;
lightOffPic1.visible = false;
}
if(lightArr[1] == 1){
  lightOffPic2.visible = true;
  lightOnPic2.visible = false;
}
else if (lightArr[1] != 1){
lightOnPic2.visible = true;
lightOffPic2.visible = false;
}
if(lightArr[2] == 1){
  lightOffPic3.visible = true;
  lightOnPic3.visible = false;
}
else if (lightArr[2] != 1){
lightOnPic3.visible = true;
lightOffPic3.visible = false;
}
if(lightArr[3] == 1){
  lightOffPic4.visible = true;
  lightOnPic4.visible = false;
}
else if (lightArr[3] != 1){
lightOnPic4.visible = true;
lightOffPic4.visible = false;
}
if(lightArr[4] == 1){
  lightOffPic5.visible = true;
  lightOnPic5.visible = false;
}
else if (lightArr[4] != 1){
lightOnPic5.visible = true;
lightOffPic5.visible = false;
}
homeLightPic.visible = true;
lightBackPic.visible = true;
}
//Hit light back button to go back to home menu
else if(menuOption == 8){
homePic2.visible = true;
thermPic.visible = true;
lightpic.visible = true;
homeLockPic.visible = true;
homeBackPic.visible = true;
lightpic2.visible = false;
lightOnPic1.visible = false;
lightOnPic2.visible = false;
lightOnPic3.visible = false;
lightOnPic4.visible = false;
lightOnPic5.visible = false;
lightOffPic1.visible = false;
lightOffPic2.visible = false;
lightOffPic3.visible = false;
lightOffPic4.visible = false;
lightOffPic5.visible = false;
homeLightPic.visible = false;
lightBackPic.visible = false;
}
}
//Calendar Start////////////////////////////
 calendarIcon2 = new fabric.Image.fromURL('resources/calender2.png',function(img) { 
 img.set({left: appPic.left *7 - 225, top: appPic.top * 1 - 500,  width: charmAppHW -30, height: charmAppHW- 30, originX: 'left', originY: 'top', visible: false});
 canvas.add(img).setActiveObject(img);;
 calendarPic2 = canvas.getActiveObject(img);
 calendarPic2.on('selected',function(){
 
  canvas.deactivateAll();
 })
 calendarPic2.lockMovementY=true;
  calendarPic2.lockMovementX=true;
});
  monthIcon = new fabric.Image.fromURL('resources/month.png',function(img) { 
 img.set({left: appPic.left *7 - 125, top: appPic.top * 1 ,  width: charmAppHW -30, height: charmAppHW- 30, originX: 'left', originY: 'top', visible: false});
 canvas.add(img).setActiveObject(img);;
 monthPic = canvas.getActiveObject(img);
 monthPic.on('selected',function(){
 calendarMenu(5);
  canvas.deactivateAll();
 })
 monthPic.lockMovementY=true;
  monthPic.lockMovementX=true;
});
      monthIcon2 = new fabric.Image.fromURL('resources/month2.png',function(img) { 
 img.set({left: appPic.left *7 - 225, top: appPic.top * 1 - 500,  width: charmAppHW -30, height: charmAppHW- 30, originX: 'left', originY: 'top', visible: false});
 canvas.add(img).setActiveObject(img);;
 monthPic2 = canvas.getActiveObject(img);
 monthPic2.on('selected',function(){
  canvas.deactivateAll();
 })
 monthPic2.lockMovementY=true;
  monthPic2.lockMovementX=true;
});
        fullMonth = new fabric.Image.fromURL('resources/monthCal.png',function(img) { 
 img.set({left: appPic.left *7 - 425, top: appPic.top * 1 - 200,  width: charmAppHW +400, height: charmAppHW + 400, originX: 'left', originY: 'top', visible: false});
 canvas.add(img).setActiveObject(img);;
 fullMonthPic = canvas.getActiveObject(img);
 fullMonthPic.on('selected',function(){
  canvas.deactivateAll();
 })
 fullMonthPic.lockMovementY=true;
  fullMonthPic.lockMovementX=true;
});
  toDoIcon = new fabric.Image.fromURL('resources/toDoList.png',function(img) { 
 img.set({left: appPic.left *7 - 325, top: appPic.top * 1 ,  width: charmAppHW -30, height: charmAppHW- 30, originX: 'left', originY: 'top', visible: false});
 canvas.add(img).setActiveObject(img);;
 toDoPic = canvas.getActiveObject(img);
 toDoPic.on('selected',function(){
  calendarMenu(3);
  canvas.deactivateAll();
 })
 toDoPic.lockMovementY=true;
  toDoPic.lockMovementX=true;
});
    toDoIcon2 = new fabric.Image.fromURL('resources/toDoList2.png',function(img) { 
 img.set({left: appPic.left *7 - 225, top: appPic.top * 1 - 500,  width: charmAppHW -30, height: charmAppHW- 30, originX: 'left', originY: 'top', visible: false});
 canvas.add(img).setActiveObject(img);;
 toDoPic2 = canvas.getActiveObject(img);
 toDoPic2.on('selected',function(){
  canvas.deactivateAll();
 })
 toDoPic2.lockMovementY=true;
  toDoPic2.lockMovementX=true;
});
      list = new fabric.Image.fromURL('resources/list.png',function(img) { 
 img.set({left: appPic.left *7 - 425, top: appPic.top * 1 - 200,  width: charmAppHW +400, height: charmAppHW + 400, originX: 'left', originY: 'top', visible: false});
 canvas.add(img).setActiveObject(img);;
 listPic = canvas.getActiveObject(img);
 listPic.on('selected',function(){
  canvas.deactivateAll();
 })
 listPic.lockMovementY=true;
  listPic.lockMovementX=true;
});
    calendarBack = new fabric.Image.fromURL('resources/back.png',function(img) { 
 img.set({left: appPic.left *7 - 225, top: appPic.top * 1 + 200 ,  width: charmAppHW -30, height: charmAppHW- 30, originX: 'left', originY: 'top', visible: false});
 canvas.add(img).setActiveObject(img);;
 calendarBackPic = canvas.getActiveObject(img);
 calendarBackPic.on('selected',function(){
  calendarMenu(2);
  canvas.deactivateAll();
 })
 calendarBackPic.lockMovementY=true;
  calendarBackPic.lockMovementX=true;
});
     toDoBackIcon = new fabric.Image.fromURL('resources/back.png',function(img) { 
 img.set({left: appPic.left *7 - 225, top: appPic.top * 1 + 500 ,  width: charmAppHW -30, height: charmAppHW- 30, originX: 'left', originY: 'top', visible: false});
 canvas.add(img).setActiveObject(img);;
 toDoBackPic = canvas.getActiveObject(img);
 toDoBackPic.on('selected',function(){
  calendarMenu(4);
  canvas.deactivateAll();
 })
 toDoBackPic.lockMovementY=true;
  toDoBackPic.lockMovementX=true;
});
         monthBack = new fabric.Image.fromURL('resources/back.png',function(img) { 
 img.set({left: appPic.left *7 - 225, top: appPic.top * 1 + 500 ,  width: charmAppHW -30, height: charmAppHW- 30, originX: 'left', originY: 'top', visible: false});
 canvas.add(img).setActiveObject(img);;
 monthBackPic = canvas.getActiveObject(img);
 monthBackPic.on('selected',function(){
  calendarMenu(6);
  canvas.deactivateAll();
 })
 monthBackPic.lockMovementY=true;
  monthBackPic.lockMovementX=true;
});
  function calendarMenu(menuOption){
  //Hit calendar button brining up calendar options
if(menuOption == 1){
calendarPic2.visible = true;
monthPic.visible = true;
toDoPic.visible = true;
calendarBackPic.visible = true;
hideApps()
}
//Hit back calendar to bring up main app menu
else if(menuOption == 2){
calendarPic2.visible = false;
monthPic.visible = false;
toDoPic.visible = false;
calendarBackPic.visible = false;
showApps()
}
//Hit todo list bringing up todo list
else if(menuOption == 3){
calendarPic2.visible = false;
monthPic.visible = false;
toDoPic.visible = false;
calendarBackPic.visible = false;
toDoPic2.visible = true;
listPic.visible = true;
toDoBackPic.visible = true;
}
//Hit back to go to calendar options
else if(menuOption == 4){
calendarPic2.visible = true;
monthPic.visible = true;
toDoPic.visible = true;
calendarBackPic.visible = true;
toDoPic2.visible = false;
listPic.visible = false;
toDoBackPic.visible = false;
}
//Hit monthly calendar
else if (menuOption == 5){
  calendarPic2.visible = false;
monthPic.visible = false;
toDoPic.visible = false;
calendarBackPic.visible = false;
monthPic2.visible = true;
monthBackPic.visible = true;
fullMonthPic.visible = true;
}
//hit back to bring up calendar options
else if (menuOption == 6){
  calendarPic2.visible = true;
monthPic.visible = true;
toDoPic.visible = true;
calendarBackPic.visible = true;
monthPic2.visible = false;
monthBackPic.visible = false;
fullMonthPic.visible = false;
}
      else {
          calendarPic.visible =false;
          calendarPic2.visible = false;
          monthPic.visible = false;
          monthPic2.visible = false;
          listPic.visible = false;
          toDoPic.visible = false;
          toDoPic2.visible = false;
          monthBackPic.visible = false;
          fullMonthPic.visible = false;
          calendarBackPic.visible = false;
      }

}
//Calendar End/////////////////////////////
//function to hide main app page apps
function hideApps(){
    weatPic.visible = false;
      calenderPic.visible = false;
       doorCamPic.visible = false;
        notesPic.visible = false;
         homePic.visible = false;
}
//Function to show main app page apps
function showApps(){
    weatPic.visible = true;
      calenderPic.visible = true;
       doorCamPic.visible = true;
        notesPic.visible = true;
         homePic.visible = true;
}
function closeHomeCal(){
monthPic2.visible = false;
monthBackPic.visible = false;
fullMonthPic.visible = false;
calendarPic2.visible = false;
monthPic.visible = false;
toDoPic.visible = false;
calendarBackPic.visible = false;
toDoPic2.visible = false;
listPic.visible = false;
toDoBackPic.visible = false;
homePic2.visible = false;
thermPic.visible = false;
lightpic.visible = false;
homeLockPic.visible = false;
homeBackPic.visible = false;
lightpic2.visible = false;
lightOnPic1.visible = false;
lightOnPic2.visible = false;
lightOnPic3.visible = false;
lightOnPic4.visible = false;
lightOnPic5.visible = false;
lightOffPic1.visible = false;
lightOffPic2.visible = false;
lightOffPic3.visible = false;
lightOffPic4.visible = false;
lightOffPic5.visible = false;
homeLightPic.visible = false;
lightBackPic.visible = false;
homeDoorPic.visible = false;
lockBackPic.visible = false;
homeLockPic2.visible = false;
unlockPic1.visible = false;
unlockPic2.visible = false;
unlockPic3.visible = false;
unlockPic4.visible = false;
lockPic1.visible = false;
lockPic2.visible = false;
lockPic3.visible = false;
lockPic4.visible = false;
thermPic2.visible = false;
tempAdjPic.visible = false;
tempBackPic.visible = false;
}



    soundIcon = new fabric.Image.fromURL('resources/sound.png', function (img) {
         img.set({
            left: appPic.left * 7 - 25,
            top: appPic.top * 1,
            width: charmAppHW - 30,
            height: charmAppHW - 30,
            originX: 'left',
            originY: 'top',
            visible: false
        });
        canvas.add(img).setActiveObject(img);
        ;
        soundPic = canvas.getActiveObject(img);
        soundPic.on('selected', function () {
            soundPress(1);
            canvas.deactivateAll();
        })
        soundPic.lockMovementY = true;
        soundPic.lockMovementX = true;
    });
    localIcon = new fabric.Image.fromURL('resources/web.png', function (img) {
        img.set({
            left: appPic.left * 7 - 225,
            top: appPic.top * 1,
            width: charmAppHW - 30,
            height: charmAppHW - 30,
            originX: 'left',
            originY: 'top',
            visible: false
        });
        canvas.add(img).setActiveObject(img);
        ;
        localPic = canvas.getActiveObject(img);
        localPic.on('selected', function () {
            localPress(1);
            canvas.deactivateAll();
        })
        localPic.lockMovementY = true;
        localPic.lockMovementX = true;
    });
    wallpaperIcon = new fabric.Image.fromURL('resources/wallpaper.png', function (img) {
        img.set({
            left: appPic.left * 7 - 425,
            top: appPic.top * 1,
            width: charmAppHW - 30,
            height: charmAppHW - 30,
            originX: 'left',
            originY: 'top',
            visible: false
        });
        canvas.add(img).setActiveObject(img);
        ;
        wallpaperPic = canvas.getActiveObject(img);
        wallpaperPic.on('selected', function () {
            wallPress(1);
            canvas.deactivateAll();
        })
        wallpaperPic.lockMovementY = true;
        wallpaperPic.lockMovementX = true;
    });





        outTempIcon = new fabric.Image.fromURL('resources/thermo.png', function (img) {
         img.set({
            left: appPic.left * 7 - 25,
            top: appPic.top * 1,
            width: charmAppHW - 30,
            height: charmAppHW - 30,
            originX: 'left',
            originY: 'top',
            visible: false
        });
        canvas.add(img).setActiveObject(img);
        ;
        outTempPic = canvas.getActiveObject(img);
        outTempPic.on('selected', function () {

            canvas.deactivateAll();
        })
        outTempPic.lockMovementY = true;
        outTempPic.lockMovementX = true;
    });
    languageIcon = new fabric.Image.fromURL('resources/languages.png', function (img) {
        img.set({
            left: appPic.left * 7 - 225,
            top: appPic.top * 1,
            width: charmAppHW - 30,
            height: charmAppHW - 30,
            originX: 'left',
            originY: 'top',
            visible: false
        });
        canvas.add(img).setActiveObject(img);
        ;
        languagePic = canvas.getActiveObject(img);
        languagePic.on('selected', function () {
            
            canvas.deactivateAll();
        })
        languagePic.lockMovementY = true;
        languagePic.lockMovementX = true;
    });
    addressIcon = new fabric.Image.fromURL('resources/contacts.png', function (img) {
        img.set({
            left: appPic.left * 7 - 425,
            top: appPic.top * 1,
            width: charmAppHW - 30,
            height: charmAppHW - 30,
            originX: 'left',
            originY: 'top',
            visible: false
        });
        canvas.add(img).setActiveObject(img);
        ;
        addressPic = canvas.getActiveObject(img);
        addressPic.on('selected', function () {
           
            canvas.deactivateAll();
        })
        addressPic.lockMovementY = true;
        addressPic.lockMovementX = true;
    });


        localBack = new fabric.Image.fromURL('resources/back.png', function (img) {
        img.set({
            left: appPic.left * 7 - 225,
            top: appPic.top * 1 + 200,
            width: charmAppHW - 30,
            height: charmAppHW - 30,
            originX: 'left',
            originY: 'top',
            visible: false
        });
        canvas.add(img).setActiveObject(img);
        ;
        localBackPic = canvas.getActiveObject(img);
        localBackPic.on('selected', function () {
            localPress(2);
            canvas.deactivateAll();
        })
        localBackPic.lockMovementY = true;
        localBackPic.lockMovementX = true;
    });



                soundBack = new fabric.Image.fromURL('resources/back.png',function(img) { 
 img.set({left: appPic.left *7 - 225, top: appPic.top * 1 + 500 ,  width: charmAppHW -30, height: charmAppHW- 30, originX: 'left', originY: 'top', visible: false});
 canvas.add(img).setActiveObject(img);;
 soundBackPic = canvas.getActiveObject(img);
 soundBackPic.on('selected',function(){
  soundPress(2);
  canvas.deactivateAll();
 })
 soundBackPic.lockMovementY=true;
  soundBackPic.lockMovementX=true;
});

              soundChoice = new fabric.Image.fromURL('resources/ss.png',function(img) { 
 img.set({left: appPic.left *7 - 425, top: appPic.top * 1 - 200,  width: charmAppHW +400, height: charmAppHW + 400, originX: 'left', originY: 'top', visible: false});
 canvas.add(img).setActiveObject(img);;
 soundChoicePic = canvas.getActiveObject(img);
 soundChoicePic.on('selected',function(){
  canvas.deactivateAll();
 })
 soundChoicePic.lockMovementY=true;
  soundChoicePic.lockMovementX=true;
});

                              wallBack = new fabric.Image.fromURL('resources/back.png',function(img) { 
 img.set({left: appPic.left *7 - 225, top: appPic.top * 1 + 500 ,  width: charmAppHW -30, height: charmAppHW- 30, originX: 'left', originY: 'top', visible: false});
 canvas.add(img).setActiveObject(img);;
 wallBackPic = canvas.getActiveObject(img);
 wallBackPic.on('selected',function(){
  wallPress(2);
  canvas.deactivateAll();
 })
 wallBackPic.lockMovementY=true;
  wallBackPic.lockMovementX=true;
});

              wallChoice = new fabric.Image.fromURL('resources/ws.png',function(img) { 
 img.set({left: appPic.left *7 - 425, top: appPic.top * 1 - 200,  width: charmAppHW +400, height: charmAppHW + 400, originX: 'left', originY: 'top', visible: false});
 canvas.add(img).setActiveObject(img);;
 wallChoicePic = canvas.getActiveObject(img);
 wallChoicePic.on('selected',function(){
  canvas.deactivateAll();
 })
 wallChoicePic.lockMovementY=true;
  wallChoicePic.lockMovementX=true;
});



        function localPress(menuOption){

          if(menuOption==1){
            closeSettings();
            languagePic.visible = true;
            outTempPic.visible = true;
            addressPic.visible = true;
            localBackPic.visible = true;
          }
            if(menuOption==2){
            showSettings();
            languagePic.visible = false;
            outTempPic.visible = false;
            addressPic.visible = false;
            localBackPic.visible = false;
          }

        }

          function soundPress(menuOption){

          if(menuOption==1){
            closeSettings();
            soundChoicePic.visible = true;
            soundBackPic.visible = true;
          }
            if(menuOption==2){
            showSettings();
            soundChoicePic.visible = false;
            soundBackPic.visible = false;
          }

        }

           function wallPress(menuOption){

          if(menuOption==1){
            closeSettings();
            wallChoicePic.visible = true;
            wallBackPic.visible = true;
          }
            if(menuOption==2){
            showSettings();
            wallChoicePic.visible = false;
            wallBackPic.visible = false;
          }

        }


function showSettings(){
    soundPic.visible = true;
      localPic.visible = true;
       wallpaperPic.visible = true;
      
}

function closeSettings(){
    soundPic.visible = false;
      localPic.visible = false;
       wallpaperPic.visible = false;
        languagePic.visible = false;
            outTempPic.visible = false;
            addressPic.visible = false;
            localBackPic.visible = false;
             wallChoicePic.visible = false;
            wallBackPic.visible = false;
            soundChoicePic.visible = false;
            soundBackPic.visible = false;
      
}
//---------------------------Matts Code End
//--------------------END-CHARMS-BAR-------------------------------
//----USER-ICONS----------------------------


//----USER-ICONS----------------------------
class User 
{
  constructor(name,icon)
  {
    this.name = name;
    this.icon = icon;
    this.notes = [];
  }
}

var users = [];
var devinIcon = new fabric.Image.fromURL('resources/duck.png', function(img) {
  img.set({
    left: userPic.left + userPic.width + userOffsetX,
    top: userPic.top,
    width: charmAppHW,
    height: charmAppHW,
    originX: 'left',
    originY: 'top',
    visible: false
  });
  img.on('added', function ()
  {
    devinText.top = img.top + img.height;
    devinText.left = img.left;
    canvas.renderAll();
  });
  canvas.add(img).setActiveObject(img);
  devinPic = canvas.getActiveObject();
  devinPic.on('moving', function animate(){
    canvas.deactivateAll().renderAll();
  });


  devinPic.lockMovementX = true;
  devinPic.lockMovementY = false;}
);
users.push(new User('Devin',devinIcon));


var tomIcon = new fabric.Image.fromURL('resources/pig.png', function(img) {
  img.set({
    left: userPic.left + (2 * (userPic.width + userOffsetX)),
    top: userPic.top,
    width: charmAppHW,
    height: charmAppHW,
    originX: 'left',
    originY: 'top',
    visible: false
  });
  img.on('added', function ()
  {
    tomText.top = img.top + img.height;
    tomText.left = img.left;
    canvas.renderAll();
  });
  canvas.add(img).setActiveObject(img);
  tomPic = canvas.getActiveObject();
  tomPic.on('moving', function animate(){
    canvas.deactivateAll().renderAll();
  });
  userPic.lockMovementX = true;
  userPic.lockMovementY = false;}
);

users.push(new User('Tom',tomIcon));

var mattIcon = new fabric.Image.fromURL('resources/lamb.png', function(img) {
  img.set({
    left: userPic.left + (3 * (userPic.width + userOffsetX)),
    top: userPic.top,
    width: charmAppHW,
    height: charmAppHW,
    originX: 'left',
    originY: 'top',
    visible: false
  });
  img.on('added', function ()
  {
    mattText.top = img.top + img.height;
    mattText.left = img.left;
    canvas.renderAll();
  });
  canvas.add(img).setActiveObject(img);
  mattPic = canvas.getActiveObject();
  mattPic.on('moving', function animate(){
    canvas.deactivateAll().renderAll();
  });
  mattPic.lockMovementX = true;
  mattPic.lockMovementY = false;}
);

users.push(new User('Matt',mattIcon));

var mikeIcon = new fabric.Image.fromURL('resources/dog.png', function(img) {
  img.set({
    left: userPic.left + userPic.width + userOffsetX,
    top: userPic.top + userPic.height + userOffsetY,
    width: charmAppHW,
    height: charmAppHW,
    originX: 'left',
    originY: 'top',
    visible: false
  });
  img.on('added', function ()
  {
    mikeText.top = img.top + img.height;
    mikeText.left = img.left;
    canvas.renderAll();
  });
  canvas.add(img).setActiveObject(img);
  mikePic = canvas.getActiveObject();
  mikePic.on('moving', function animate(){
    canvas.deactivateAll().renderAll();
  });
  mikePic.lockMovementX = true;
  mikePic.lockMovementY = false;}
);

users.push(new User('Mike',mikeIcon));

var ryanIcon = new fabric.Image.fromURL('resources/eagle.png', function(img) {
  img.set({
    left: userPic.left + (2 * (userPic.width + userOffsetX)),
    top: userPic.top + userPic.height + userOffsetY,
    width: charmAppHW,
    height: charmAppHW,
    originX: 'left',
    originY: 'top',
    visible: false
  });
  img.on('added', function ()
  {
    ryanText.top = img.top + img.height;
    ryanText.left = img.left;
    canvas.renderAll();
  });
  canvas.add(img).setActiveObject(img);
  ryanPic = canvas.getActiveObject();
  ryanPic.on('moving', function animate(){
    canvas.deactivateAll().renderAll();
  });
  ryanPic.lockMovementX = true;
  ryanPic.lockMovementY = false;}
);

users.push(new User('Ryan',ryanIcon));

var gregIcon = new fabric.Image.fromURL('resources/bunny.png', function(img){
  img.set({
    left: userPic.left + (3 * (userPic.width + userOffsetX)),
    top: userPic.top + userPic.height + userOffsetY,
    width: charmAppHW,
    height: charmAppHW,
    originX: 'left',
    originY: 'top',
    visible: false
  });
  canvas.add(img).setActiveObject(img);
  gregPic = canvas.getActiveObject();

  gregPic.lockMovementX = true;
  gregPic.lockMovementY = false;
});

users.push(new User('Greg',gregIcon));

var addUserIcon = new fabric.Image.fromURL('resources/addUser.png', function(img) {
  img.set({
    left: userPic.left + (3 * (userPic.width + userOffsetX)),
    top: userPic.top + userPic.height + userOffsetY,
    width: charmAppHW,
    height: charmAppHW,
    originX: 'left',
    originY: 'top',
    visible: false
  });
  img.on('added', function ()
  {
    canvas.renderAll();
  });
  canvas.add(img).setActiveObject(img);
  addUserPic = canvas.getActiveObject();

  addUserPic.on('moving', function animate(){
    canvas.deactivateAll().renderAll();
  });

  addUserPic.on('selected', function (){
    if(addUserSelect){
      changePic(addUserPic,'resources/addUser2.png')
      addUserPic.top = userPic.top - userPic.height;
      addUserPic.left = userPic.left + (2 * (userPic.width + userOffsetX));
      showUsers(false);
      showNewUsers(true);
    }else{
      changePic(addUserPic,'resources/addUser.png')
    }
    addUserSelect = !addUserSelect;
    canvas.deactivateAll();
  });

  addUserPic.lockMovementX = true;
  addUserPic.lockMovementY = false;}
);


var addUserIcon;

var tomText = new fabric.Text("Tom",{  
  left: tomIcon.left,
  top: tomIcon.top,
  originX: 'left',
  originY: 'top',
  fontWeight: 'bold',
  shadow: "rgba(0,0,0,0.2) 0px 0px 10px",
  visible: false,
  fontFamily: 'droid serif',
  fontSize: 50,
  lockMovementX: true,
  lockMovementY: true
});
var mikeText = new fabric.Text("Mike",{  
  left: mikeIcon.left,
  top: mikeIcon.top,
  originX: 'left',
  originY: 'top',
  fontWeight: 'bold',
  shadow: "rgba(0,0,0,0.2) 0px 0px 10px",
  visible: false,
  fontFamily: 'droid serif',
  fontSize: 50,
  lockMovementX: true,
  lockMovementY: true
});
var ryanText = new fabric.Text("Ryan",{  
  left: ryanIcon.left,
  top: ryanIcon.top,
  originX: 'left',
  originY: 'top',
  fontWeight: 'bold',
  shadow: "rgba(0,0,0,0.2) 0px 0px 10px",
  visible: false,
  fontFamily: 'droid serif',
  fontSize: 50,
  lockMovementX: true,
  lockMovementY: true
});
var mattText = new fabric.Text("Matt",{  
  left: mattIcon.left,
  top: mattIcon.top,
  originX: 'left',
  originY: 'top',
  fontWeight: 'bold',
  shadow: "rgba(0,0,0,0.2) 0px 0px 10px",
  visible: false,
  fontFamily: 'droid serif',
  fontSize: 50,
  lockMovementX: true,
  lockMovementY: true
});
var devinText  = new fabric.Text("Devin",{  
  left: devinIcon.left,
  top: devinIcon.top,
  originX: 'left',
  originY: 'top',
  fontWeight: 'bold',
  shadow: "rgba(0,0,0,0.2) 0px 0px 10px",
  visible: false,
  fontFamily: 'droid serif',
  fontSize: 50,
  lockMovementX: true,
  lockMovementY: true
});

var bunnyIcon = new fabric.Image.fromURL('resources/bunny.png', function(img) {
  img.set({
    left: userPic.left + userPic.width + userOffsetX,
    top: userPic.top,
    width: charmAppHW,
    height: charmAppHW,
    originX: 'left',
    originY: 'top',
    visible: false
  });
  canvas.add(img).setActiveObject(img);
  bunnyPic = canvas.getActiveObject();
  bunnyPic.on('moving', function animate(){
    canvas.deactivateAll().renderAll();
  });
  bunnyPic.on('selected',function (){
    userAdded = true;
    addUserPic.left = userPic.left + (userAdded ? (2 * (userPic.width + userOffsetX)) : (userPic.width + userOffsetX));
    moveUsers();
    showUsers(true);
    showNewUsers(false);
  });
  bunnyPic.lockMovementX = true;
  bunnyPic.lockMovementY = false;}
);

function getUser(name)
{
  for(var i=0; i<users.length; ++i)
  {
    if(users[i].name == name)
    {
      return users[i];
    }
  }
}

function showUsers(visible)
{
  ryanPic.visible = visible;
  mikePic.visible = visible;
  devinPic.visible = visible;
  mattPic.visible = visible;
  tomPic.visible = visible;
  ryanText.visible = visible;
  mikeText.visible = visible;
  devinText.visible = visible;
  mattText.visible = visible;
  tomText.visible = visible;
  addUserPic.visible = addUserSelect; 
  gregPic.visible = userAdded && visible;
}

function showNewUsers(visible)
{
  bunnyPic.visible = visible;
}
function moveUsers()
{
  gregPic.top = userPic.top + userPic.height + userOffsetY;
  devinPic.top = userPic.top;
  mattPic.top = userPic.top;
  tomPic.top = userPic.top;
  ryanPic.top = userPic.top + userPic.height + userOffsetY;
  mikePic.top = userPic.top + userPic.height + userOffsetY;
  addUserPic.top = userPic.top + (addUserSelect ? (userAdded ? (2 * (userPic.height + userOffsetY)) : userPic.height + userOffsetY) : -userPic.height);
  devinText.top = devinPic.top + userPic.height;
  devinText.left = devinPic.left;
  mattText.top = mattPic.top + userPic.height;
  mattText.left = mattPic.left;
  ryanText.top = ryanPic.top + userPic.height;
  ryanText.left = ryanPic.left;
  tomText.top = tomPic.top + userPic.height;
  tomText.left = tomPic.left;
  mikeText.top = mikePic.top + userPic.height;
  mikeText.left = mikePic.left;
  bunnyPic.top = userPic.top;
}

function postCharmMove()
{
  updateAppPos();
  userIcon.top = userPic.top;
  userIcon.left = userPic.left;
  emergencyIcon.top = emergencyPic.top;
  emergencyIcon.left = emergencyPic.left;
  appIcon.top = appPic.top;
  appIcon.left = appPic.left;
  settingsIcon.top = settingsPic.top;
  settingsIcon.left = settingsPic.left;
  addUserIcon.top = addUserPic.top;
  addUserIcon.left = addUserPic.left;

  userPic.setCoords();
  emergencyPic.setCoords();
  appPic.setCoords();
  settingsPic.setCoords();
  addUserPic.setCoords();
  debugLog();
  canvas.deactivateAll().renderAll().calcOffset();
}
//----END-USER-ICONS------------------------
// add all of the elements to the canvas
//canvas.add(charmsBar);
canvas.add(insideDoor);
canvas.add(outsideDoor);
canvas.add(insideHandle);
canvas.add(outsideHandle);
canvas.add(clock);
canvas.add(date);
canvas.add(amPm);
canvas.add(degrees);
canvas.add(debug);
canvas.add(mikeText);
canvas.add(mattText);
canvas.add(tomText);
canvas.add(ryanText);
canvas.add(devinText);


// code adapted from http://jsfiddle.net/tornado1979/39up3jcm/
// this code deals with scaling all the elements on the canvas
function zoomAll(SCALE_FACTOR) {
      var objects = canvas.getObjects();
      for (var i in objects) {
          var scaleX = objects[i].scaleX;
          var scaleY = objects[i].scaleY;
          var left = objects[i].left;
          var top = objects[i].top;
          var tempScaleX = scaleX * SCALE_FACTOR;
          var tempScaleY = scaleY * SCALE_FACTOR;
          var tempLeft = left * SCALE_FACTOR;
          var tempTop = top * SCALE_FACTOR;
          objects[i].scaleX = tempScaleX;
          objects[i].scaleY = tempScaleY;
          objects[i].left = tempLeft;
          objects[i].top = tempTop;
          objects[i].setCoords();
      }
  
      canvas.renderAll();
  }
// draw everything at the appropriate scale for this canvas
zoomAll(canvas.height / localHeight);
</script>

</body>
      
</html>